/**
* viewedit-v1.0.0 ISC License By 
* github: https://github.com/w3cui/ViewEdit#readme
**/
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).html2canvas=t()}}(function(){return function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return r(n||t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){(function(t){!function(i){function r(t){throw new RangeError(O[t])}function o(t,e){for(var n=t.length,i=[];n--;)i[n]=e(t[n]);return i}function a(t,e){var n=t.split("@"),i="";n.length>1&&(i=n[0]+"@",t=n[1]);return i+o((t=t.replace(C,".")).split("."),e).join(".")}function s(t){for(var e,n,i=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(n=t.charCodeAt(r++)))?i.push(((1023&e)<<10)+(1023&n)+65536):(i.push(e),r--):i.push(e);return i}function c(t){return o(t,function(t){var e="";return t>65535&&(e+=L((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=L(t)}).join("")}function u(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function l(t,e,n){var i=0;for(t=n?A(t/_):t>>1,t+=A(t/e);t>D*x>>1;i+=b)t=A(t/D);return A(i+(D+1)*t/(t+k))}function d(t){var e,n,i,o,a,s,u,d,h,p,f=[],g=t.length,m=0,v=T,k=E;for((n=t.lastIndexOf(S))<0&&(n=0),i=0;i<n;++i)t.charCodeAt(i)>=128&&r("not-basic"),f.push(t.charCodeAt(i));for(o=n>0?n+1:0;o<g;){for(a=m,s=1,u=b;o>=g&&r("invalid-input"),((d=function(t){return t-48<10?t-22:t-65<26?t-65:t-97<26?t-97:b}(t.charCodeAt(o++)))>=b||d>A((y-m)/s))&&r("overflow"),m+=d*s,h=u<=k?w:u>=k+x?x:u-k,!(d<h);u+=b)s>A(y/(p=b-h))&&r("overflow"),s*=p;k=l(m-a,e=f.length+1,0==a),A(m/e)>y-v&&r("overflow"),v+=A(m/e),m%=e,f.splice(m++,0,v)}return c(f)}function h(t){var e,n,i,o,a,c,d,h,p,f,g,m,v,k,_,R=[];for(m=(t=s(t)).length,e=T,n=0,a=E,c=0;c<m;++c)(g=t[c])<128&&R.push(L(g));for(i=o=R.length,o&&R.push(S);i<m;){for(d=y,c=0;c<m;++c)(g=t[c])>=e&&g<d&&(d=g);for(d-e>A((y-n)/(v=i+1))&&r("overflow"),n+=(d-e)*v,e=d,c=0;c<m;++c)if((g=t[c])<e&&++n>y&&r("overflow"),g==e){for(h=n,p=b;f=p<=a?w:p>=a+x?x:p-a,!(h<f);p+=b)_=h-f,k=b-f,R.push(L(u(f+_%k,0))),h=A(_/k);R.push(L(u(h,0))),a=l(n,v,i==o),n=0,++i}++n,++e}return R.join("")}var p="object"==typeof n&&n&&!n.nodeType&&n,f="object"==typeof e&&e&&!e.nodeType&&e,g="object"==typeof t&&t;g.global!==g&&g.window!==g&&g.self!==g||(i=g);var m,v,y=2147483647,b=36,w=1,x=26,k=38,_=700,E=72,T=128,S="-",R=/^xn--/,I=/[^\x20-\x7E]/,C=/[\x2E\u3002\uFF0E\uFF61]/g,O={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},D=b-w,A=Math.floor,L=String.fromCharCode;if(m={version:"1.3.2",ucs2:{decode:s,encode:c},decode:d,encode:h,toASCII:function(t){return a(t,function(t){return I.test(t)?"xn--"+h(t):t})},toUnicode:function(t){return a(t,function(t){return R.test(t)?d(t.slice(4).toLowerCase()):t})}},p&&f)if(e.exports==p)f.exports=m;else for(v in m)m.hasOwnProperty(v)&&(p[v]=m[v]);else i.punycode=m}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(t,e,n){function i(t,e){for(var n=3===t.nodeType?document.createTextNode(t.nodeValue):t.cloneNode(!1),r=t.firstChild;r;)!0!==e&&1===r.nodeType&&"SCRIPT"===r.nodeName||n.appendChild(i(r,e)),r=r.nextSibling;return 1===t.nodeType&&(n._scrollTop=t.scrollTop,n._scrollLeft=t.scrollLeft,"CANVAS"===t.nodeName?function(t,e){try{e&&(e.width=t.width,e.height=t.height,e.getContext("2d").putImageData(t.getContext("2d").getImageData(0,0,t.width,t.height),0,0))}catch(e){o("Unable to copy canvas content from",t,e)}}(t,n):"TEXTAREA"!==t.nodeName&&"SELECT"!==t.nodeName||(n.value=t.value)),n}function r(t){if(1===t.nodeType){t.scrollTop=t._scrollTop,t.scrollLeft=t._scrollLeft;for(var e=t.firstChild;e;)r(e),e=e.nextSibling}}var o=t("./log");e.exports=function(t,e,n,o,a,s,c){var u=i(t.documentElement,a.javascriptEnabled),l=e.createElement("iframe");return l.className="html2canvas-container",l.style.visibility="hidden",l.style.position="fixed",l.style.left="-10000px",l.style.top="0px",l.style.border="0",l.width=n,l.height=o,l.scrolling="no",e.body.appendChild(l),new Promise(function(e){var n=l.contentWindow.document;l.contentWindow.onload=l.onload=function(){var t=setInterval(function(){n.body.childNodes.length>0&&(r(n.documentElement),clearInterval(t),"view"===a.type&&(l.contentWindow.scrollTo(s,c),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||l.contentWindow.scrollY===c&&l.contentWindow.scrollX===s||(n.documentElement.style.top=-c+"px",n.documentElement.style.left=-s+"px",n.documentElement.style.position="absolute")),e(l))},50)},n.open(),n.write("<!DOCTYPE html><html></html>"),function(t,e,n){!t.defaultView||e===t.defaultView.pageXOffset&&n===t.defaultView.pageYOffset||t.defaultView.scrollTo(e,n)}(t,s,c),n.replaceChild(n.adoptNode(u),n.documentElement),n.close()})}},{"./log":13}],3:[function(t,e,n){function i(t){this.r=0,this.g=0,this.b=0,this.a=null;this.fromArray(t)||this.namedColor(t)||this.rgb(t)||this.rgba(t)||this.hex6(t)||this.hex3(t)}i.prototype.darken=function(t){var e=1-t;return new i([Math.round(this.r*e),Math.round(this.g*e),Math.round(this.b*e),this.a])},i.prototype.isTransparent=function(){return 0===this.a},i.prototype.isBlack=function(){return 0===this.r&&0===this.g&&0===this.b},i.prototype.fromArray=function(t){return Array.isArray(t)&&(this.r=Math.min(t[0],255),this.g=Math.min(t[1],255),this.b=Math.min(t[2],255),t.length>3&&(this.a=t[3])),Array.isArray(t)};var r=/^#([a-f0-9]{3})$/i;i.prototype.hex3=function(t){var e=null;return null!==(e=t.match(r))&&(this.r=parseInt(e[1][0]+e[1][0],16),this.g=parseInt(e[1][1]+e[1][1],16),this.b=parseInt(e[1][2]+e[1][2],16)),null!==e};var o=/^#([a-f0-9]{6})$/i;i.prototype.hex6=function(t){var e=null;return null!==(e=t.match(o))&&(this.r=parseInt(e[1].substring(0,2),16),this.g=parseInt(e[1].substring(2,4),16),this.b=parseInt(e[1].substring(4,6),16)),null!==e};var a=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/;i.prototype.rgb=function(t){var e=null;return null!==(e=t.match(a))&&(this.r=Number(e[1]),this.g=Number(e[2]),this.b=Number(e[3])),null!==e};var s=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d?\.?\d+)\s*\)$/;i.prototype.rgba=function(t){var e=null;return null!==(e=t.match(s))&&(this.r=Number(e[1]),this.g=Number(e[2]),this.b=Number(e[3]),this.a=Number(e[4])),null!==e},i.prototype.toString=function(){return null!==this.a&&1!==this.a?"rgba("+[this.r,this.g,this.b,this.a].join(",")+")":"rgb("+[this.r,this.g,this.b].join(",")+")"},i.prototype.namedColor=function(t){t=t.toLowerCase();var e=c[t];if(e)this.r=e[0],this.g=e[1],this.b=e[2];else if("transparent"===t)return this.r=this.g=this.b=this.a=0,!0;return!!e},i.prototype.isColor=!0;var c={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};e.exports=i},{}],4:[function(t,e,n){function i(t,e){var n=v++;if((e=e||{}).logging&&(d.options.logging=!0,d.options.start=Date.now()),e.async=void 0===e.async||e.async,e.allowTaint=void 0!==e.allowTaint&&e.allowTaint,e.removeContainer=void 0===e.removeContainer||e.removeContainer,e.javascriptEnabled=void 0!==e.javascriptEnabled&&e.javascriptEnabled,e.imageTimeout=void 0===e.imageTimeout?1e4:e.imageTimeout,e.renderer="function"==typeof e.renderer?e.renderer:s,e.strict=!!e.strict,"string"==typeof t){if("string"!=typeof e.proxy)return Promise.reject("Proxy must be used when rendering url");var i=null!=e.width?e.width:window.innerWidth,o=null!=e.height?e.height:window.innerHeight;return f(function(t){var e=document.createElement("a");return e.href=t,e.href=e.href,e}(t),e.proxy,document,i,o,e).then(function(t){return r(t.contentWindow.document.documentElement,t,e,i,o)})}var a=(void 0===t?[document.documentElement]:t.length?t:[t])[0];return a.setAttribute(m+n,n),function(t,e,n,i,o){return p(t,t,n,i,e,t.defaultView.pageXOffset,t.defaultView.pageYOffset).then(function(a){d("Document cloned");var s=m+o,c="["+s+"='"+o+"']";t.querySelector(c).removeAttribute(s);var u=a.contentWindow,l=u.document.querySelector(c);return("function"==typeof e.onclone?Promise.resolve(e.onclone(u.document)):Promise.resolve(!0)).then(function(){return r(l,a,e,n,i)})})}(a.ownerDocument,e,a.ownerDocument.defaultView.innerWidth,a.ownerDocument.defaultView.innerHeight,n).then(function(t){return"function"==typeof e.onrendered&&(d("options.onrendered is deprecated, html2canvas returns a Promise containing the canvas"),e.onrendered(t)),t})}function r(t,e,n,i,r){var s=e.contentWindow,l=new a(s.document),h=new c(n,l),p=g(t),f="view"===n.type?i:function(t){return Math.max(Math.max(t.body.scrollWidth,t.documentElement.scrollWidth),Math.max(t.body.offsetWidth,t.documentElement.offsetWidth),Math.max(t.body.clientWidth,t.documentElement.clientWidth))}(s.document),m="view"===n.type?r:function(t){return Math.max(Math.max(t.body.scrollHeight,t.documentElement.scrollHeight),Math.max(t.body.offsetHeight,t.documentElement.offsetHeight),Math.max(t.body.clientHeight,t.documentElement.clientHeight))}(s.document),v=new n.renderer(f,m,h,n,document);return new u(t,v,l,h,n).ready.then(function(){d("Finished rendering");var i;return i="view"===n.type?o(v.canvas,{width:v.canvas.width,height:v.canvas.height,top:0,left:0,x:0,y:0}):t===s.document.body||t===s.document.documentElement||null!=n.canvas?v.canvas:o(v.canvas,{width:null!=n.width?n.width:p.width,height:null!=n.height?n.height:p.height,top:p.top,left:p.left,x:0,y:0}),function(t,e){e.removeContainer&&(t.parentNode.removeChild(t),d("Cleaned up container"))}(e,n),i})}function o(t,e){var n=document.createElement("canvas"),i=Math.min(t.width-1,Math.max(0,e.left)),r=Math.min(t.width,Math.max(1,e.left+e.width)),o=Math.min(t.height-1,Math.max(0,e.top)),a=Math.min(t.height,Math.max(1,e.top+e.height));n.width=e.width,n.height=e.height;var s=r-i,c=a-o;return d("Cropping canvas at:","left:",e.left,"top:",e.top,"width:",s,"height:",c),d("Resulting crop with width",e.width,"and height",e.height,"with x",i,"and y",o),n.getContext("2d").drawImage(t,i,o,s,c,e.x,e.y,s,c),n}var a=t("./support"),s=t("./renderers/canvas"),c=t("./imageloader"),u=t("./nodeparser"),l=t("./nodecontainer"),d=t("./log"),h=t("./utils"),p=t("./clone"),f=t("./proxy").loadUrlDocument,g=h.getBounds,m="data-html2canvas-node",v=0;i.CanvasRenderer=s,i.NodeContainer=l,i.log=d,i.utils=h;var y="undefined"==typeof document||"function"!=typeof Object.create||"function"!=typeof document.createElement("canvas").getContext?function(){return Promise.reject("No canvas support")}:i;e.exports=y},{"./clone":2,"./imageloader":11,"./log":13,"./nodecontainer":14,"./nodeparser":15,"./proxy":16,"./renderers/canvas":20,"./support":22,"./utils":26}],5:[function(t,e,n){function i(t){if(this.src=t,r("DummyImageContainer for",t),!this.promise||!this.image){r("Initiating DummyImageContainer"),i.prototype.image=new Image;var e=this.image;i.prototype.promise=new Promise(function(t,n){e.onload=t,e.onerror=n,e.src=o(),!0===e.complete&&t(e)})}}var r=t("./log"),o=t("./utils").smallImage;e.exports=i},{"./log":13,"./utils":26}],6:[function(t,e,n){var i=t("./utils").smallImage;e.exports=function(t,e){var n,r,o=document.createElement("div"),a=document.createElement("img"),s=document.createElement("span");o.style.visibility="hidden",o.style.fontFamily=t,o.style.fontSize=e,o.style.margin=0,o.style.padding=0,document.body.appendChild(o),a.src=i(),a.width=1,a.height=1,a.style.margin=0,a.style.padding=0,a.style.verticalAlign="baseline",s.style.fontFamily=t,s.style.fontSize=e,s.style.margin=0,s.style.padding=0,s.appendChild(document.createTextNode("Hidden Text")),o.appendChild(s),o.appendChild(a),n=a.offsetTop-s.offsetTop+1,o.removeChild(s),o.appendChild(document.createTextNode("Hidden Text")),o.style.lineHeight="normal",a.style.verticalAlign="super",r=a.offsetTop-o.offsetTop+1,document.body.removeChild(o),this.baseline=n,this.lineWidth=1,this.middle=r}},{"./utils":26}],7:[function(t,e,n){function i(){this.data={}}var r=t("./font");i.prototype.getMetrics=function(t,e){return void 0===this.data[t+"-"+e]&&(this.data[t+"-"+e]=new r(t,e)),this.data[t+"-"+e]},e.exports=i},{"./font":6}],8:[function(t,e,n){function i(e,n,i){this.image=null,this.src=e;var o=this,a=r(e);this.promise=(n?new Promise(function(t){"about:blank"===e.contentWindow.document.URL||null==e.contentWindow.document.documentElement?e.contentWindow.onload=e.onload=function(){t(e)}:t(e)}):this.proxyLoad(i.proxy,a,i)).then(function(e){return t("./core")(e.contentWindow.document.documentElement,{type:"view",width:e.width,height:e.height,proxy:i.proxy,javascriptEnabled:i.javascriptEnabled,removeContainer:i.removeContainer,allowTaint:i.allowTaint,imageTimeout:i.imageTimeout/2})}).then(function(t){return o.image=t})}var r=t("./utils").getBounds,o=t("./proxy").loadUrlDocument;i.prototype.proxyLoad=function(t,e,n){var i=this.src;return o(i.src,t,i.ownerDocument,e.width,e.height,n)},e.exports=i},{"./core":4,"./proxy":16,"./utils":26}],9:[function(t,e,n){function i(t){this.src=t.value,this.colorStops=[],this.type=null,this.x0=.5,this.y0=.5,this.x1=.5,this.y1=.5,this.promise=Promise.resolve(!0)}i.TYPES={LINEAR:1,RADIAL:2},i.REGEXP_COLORSTOP=/^\s*(rgba?\(\s*\d{1,3},\s*\d{1,3},\s*\d{1,3}(?:,\s*[0-9\.]+)?\s*\)|[a-z]{3,20}|#[a-f0-9]{3,6})(?:\s+(\d{1,3}(?:\.\d+)?)(%|px)?)?(?:\s|$)/i,e.exports=i},{}],10:[function(t,e,n){e.exports=function(t,e){this.src=t,this.image=new Image;var n=this;this.tainted=null,this.promise=new Promise(function(i,r){n.image.onload=i,n.image.onerror=r,e&&(n.image.crossOrigin="anonymous"),n.image.src=t,!0===n.image.complete&&i(n.image)})}},{}],11:[function(t,e,n){function i(t,e){this.link=null,this.options=t,this.support=e,this.origin=this.getOrigin(window.location.href)}var r=t("./log"),o=t("./imagecontainer"),a=t("./dummyimagecontainer"),s=t("./proxyimagecontainer"),c=t("./framecontainer"),u=t("./svgcontainer"),l=t("./svgnodecontainer"),d=t("./lineargradientcontainer"),h=t("./webkitgradientcontainer"),p=t("./utils").bind;i.prototype.findImages=function(t){var e=[];return t.reduce(function(t,e){switch(e.node.nodeName){case"IMG":return t.concat([{args:[e.node.src],method:"url"}]);case"svg":case"IFRAME":return t.concat([{args:[e.node],method:e.node.nodeName}])}return t},[]).forEach(this.addImage(e,this.loadImage),this),e},i.prototype.findBackgroundImage=function(t,e){return e.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(t,this.loadImage),this),t},i.prototype.addImage=function(t,e){return function(n){n.args.forEach(function(i){this.imageExists(t,i)||(t.splice(0,0,e.call(this,n)),r("Added image #"+t.length,"string"==typeof i?i.substring(0,100):i))},this)}},i.prototype.hasImageBackground=function(t){return"none"!==t.method},i.prototype.loadImage=function(t){if("url"===t.method){var e=t.args[0];return!this.isSVG(e)||this.support.svg||this.options.allowTaint?e.match(/data:image\/.*;base64,/i)?new o(e.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),!1):this.isSameOrigin(e)||!0===this.options.allowTaint||this.isSVG(e)?new o(e,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new o(e,!0):this.options.proxy?new s(e,this.options.proxy):new a(e):new u(e)}return"linear-gradient"===t.method?new d(t):"gradient"===t.method?new h(t):"svg"===t.method?new l(t.args[0],this.support.svg):"IFRAME"===t.method?new c(t.args[0],this.isSameOrigin(t.args[0].src),this.options):new a(t)},i.prototype.isSVG=function(t){return"svg"===t.substring(t.length-3).toLowerCase()||u.prototype.isInline(t)},i.prototype.imageExists=function(t,e){return t.some(function(t){return t.src===e})},i.prototype.isSameOrigin=function(t){return this.getOrigin(t)===this.origin},i.prototype.getOrigin=function(t){var e=this.link||(this.link=document.createElement("a"));return e.href=t,e.href=e.href,e.protocol+e.hostname+e.port},i.prototype.getPromise=function(t){return this.timeout(t,this.options.imageTimeout).catch(function(){return new a(t.src).promise.then(function(e){t.image=e})})},i.prototype.get=function(t){var e=null;return this.images.some(function(n){return(e=n).src===t})?e:null},i.prototype.fetch=function(t){return this.images=t.reduce(p(this.findBackgroundImage,this),this.findImages(t)),this.images.forEach(function(t,e){t.promise.then(function(){r("Succesfully loaded image #"+(e+1),t)},function(n){r("Failed loading image #"+(e+1),t,n)})}),this.ready=Promise.all(this.images.map(this.getPromise,this)),r("Finished searching images"),this},i.prototype.timeout=function(t,e){var n,i=Promise.race([t.promise,new Promise(function(i,o){n=setTimeout(function(){r("Timed out loading image",t),o(t)},e)})]).then(function(t){return clearTimeout(n),t});return i.catch(function(){clearTimeout(n)}),i},e.exports=i},{"./dummyimagecontainer":5,"./framecontainer":8,"./imagecontainer":10,"./lineargradientcontainer":12,"./log":13,"./proxyimagecontainer":17,"./svgcontainer":23,"./svgnodecontainer":24,"./utils":26,"./webkitgradientcontainer":27}],12:[function(t,e,n){function i(t){r.apply(this,arguments),this.type=r.TYPES.LINEAR;var e=i.REGEXP_DIRECTION.test(t.args[0])||!r.REGEXP_COLORSTOP.test(t.args[0]);e?t.args[0].split(/\s+/).reverse().forEach(function(t,e){switch(t){case"left":this.x0=0,this.x1=1;break;case"top":this.y0=0,this.y1=1;break;case"right":this.x0=1,this.x1=0;break;case"bottom":this.y0=1,this.y1=0;break;case"to":var n=this.y0,i=this.x0;this.y0=this.y1,this.x0=this.x1,this.x1=i,this.y1=n;break;case"center":break;default:var r=.01*parseFloat(t,10);if(isNaN(r))break;0===e?(this.y0=r,this.y1=1-this.y0):(this.x0=r,this.x1=1-this.x0)}},this):(this.y0=0,this.y1=1),this.colorStops=t.args.slice(e?1:0).map(function(t){var e=t.match(r.REGEXP_COLORSTOP),n=+e[2],i=0===n?"%":e[3];return{color:new o(e[1]),stop:"%"===i?n/100:null}}),null===this.colorStops[0].stop&&(this.colorStops[0].stop=0),null===this.colorStops[this.colorStops.length-1].stop&&(this.colorStops[this.colorStops.length-1].stop=1),this.colorStops.forEach(function(t,e){null===t.stop&&this.colorStops.slice(e).some(function(n,i){return null!==n.stop&&(t.stop=(n.stop-this.colorStops[e-1].stop)/(i+1)+this.colorStops[e-1].stop,!0)},this)},this)}var r=t("./gradientcontainer"),o=t("./color");i.prototype=Object.create(r.prototype),i.REGEXP_DIRECTION=/^\s*(?:to|left|right|top|bottom|center|\d{1,3}(?:\.\d+)?%?)(?:\s|$)/i,e.exports=i},{"./color":3,"./gradientcontainer":9}],13:[function(t,e,n){var i=function(){i.options.logging&&window.console&&window.console.log&&Function.prototype.bind.call(window.console.log,window.console).apply(window.console,[Date.now()-i.options.start+"ms","html2canvas:"].concat([].slice.call(arguments,0)))};i.options={logging:!1},e.exports=i},{}],14:[function(t,e,n){function i(t,e){this.node=t,this.parent=e,this.stack=null,this.bounds=null,this.borders=null,this.clip=[],this.backgroundClip=[],this.offsetBounds=null,this.visible=null,this.computedStyles=null,this.colors={},this.styles={},this.backgroundImages=null,this.transformData=null,this.transformMatrix=null,this.isPseudoElement=!1,this.opacity=null}function r(t){return-1!==t.toString().indexOf("%")}var o=t("./color"),a=t("./utils"),s=a.getBounds,c=a.parseBackgrounds,u=a.offsetBounds;i.prototype.cloneTo=function(t){t.visible=this.visible,t.borders=this.borders,t.bounds=this.bounds,t.clip=this.clip,t.backgroundClip=this.backgroundClip,t.computedStyles=this.computedStyles,t.styles=this.styles,t.backgroundImages=this.backgroundImages,t.opacity=this.opacity},i.prototype.getOpacity=function(){return null===this.opacity?this.opacity=this.cssFloat("opacity"):this.opacity},i.prototype.assignStack=function(t){this.stack=t,t.children.push(this)},i.prototype.isElementVisible=function(){return this.node.nodeType===Node.TEXT_NODE?this.parent.visible:"none"!==this.css("display")&&"hidden"!==this.css("visibility")&&!this.node.hasAttribute("data-html2canvas-ignore")&&("INPUT"!==this.node.nodeName||"hidden"!==this.node.getAttribute("type"))},i.prototype.css=function(t){return this.computedStyles||(this.computedStyles=this.isPseudoElement?this.parent.computedStyle(this.before?":before":":after"):this.computedStyle(null)),this.styles[t]||(this.styles[t]=this.computedStyles[t])},i.prototype.prefixedCss=function(t){var e=this.css(t);return void 0===e&&["webkit","moz","ms","o"].some(function(n){return void 0!==(e=this.css(n+t.substr(0,1).toUpperCase()+t.substr(1)))},this),void 0===e?null:e},i.prototype.computedStyle=function(t){return this.node.ownerDocument.defaultView.getComputedStyle(this.node,t)},i.prototype.cssInt=function(t){var e=parseInt(this.css(t),10);return isNaN(e)?0:e},i.prototype.color=function(t){return this.colors[t]||(this.colors[t]=new o(this.css(t)))},i.prototype.cssFloat=function(t){var e=parseFloat(this.css(t));return isNaN(e)?0:e},i.prototype.fontWeight=function(){var t=this.css("fontWeight");switch(parseInt(t,10)){case 401:t="bold";break;case 400:t="normal"}return t},i.prototype.parseClip=function(){var t=this.css("clip").match(this.CLIP);return t?{top:parseInt(t[1],10),right:parseInt(t[2],10),bottom:parseInt(t[3],10),left:parseInt(t[4],10)}:null},i.prototype.parseBackgroundImages=function(){return this.backgroundImages||(this.backgroundImages=c(this.css("backgroundImage")))},i.prototype.cssList=function(t,e){var n=(this.css(t)||"").split(",");return n=n[e||0]||n[0]||"auto",1===(n=n.trim().split(" ")).length&&(n=[n[0],r(n[0])?"auto":n[0]]),n},i.prototype.parseBackgroundSize=function(t,e,n){var i,o,a=this.cssList("backgroundSize",n);if(r(a[0]))i=t.width*parseFloat(a[0])/100;else{if(/contain|cover/.test(a[0])){var s=t.width/t.height,c=e.width/e.height;return s<c^"contain"===a[0]?{width:t.height*c,height:t.height}:{width:t.width,height:t.width/c}}i=parseInt(a[0],10)}return o="auto"===a[0]&&"auto"===a[1]?e.height:"auto"===a[1]?i/e.width*e.height:r(a[1])?t.height*parseFloat(a[1])/100:parseInt(a[1],10),"auto"===a[0]&&(i=o/e.height*e.width),{width:i,height:o}},i.prototype.parseBackgroundPosition=function(t,e,n,i){var o,a,s=this.cssList("backgroundPosition",n);return o=r(s[0])?(t.width-(i||e).width)*(parseFloat(s[0])/100):parseInt(s[0],10),a="auto"===s[1]?o/e.width*e.height:r(s[1])?(t.height-(i||e).height)*parseFloat(s[1])/100:parseInt(s[1],10),"auto"===s[0]&&(o=a/e.height*e.width),{left:o,top:a}},i.prototype.parseBackgroundRepeat=function(t){return this.cssList("backgroundRepeat",t)[0]},i.prototype.parseTextShadows=function(){var t=this.css("textShadow"),e=[];if(t&&"none"!==t)for(var n=t.match(this.TEXT_SHADOW_PROPERTY),i=0;n&&i<n.length;i++){var r=n[i].match(this.TEXT_SHADOW_VALUES);e.push({color:new o(r[0]),offsetX:r[1]?parseFloat(r[1].replace("px","")):0,offsetY:r[2]?parseFloat(r[2].replace("px","")):0,blur:r[3]?r[3].replace("px",""):0})}return e},i.prototype.parseTransform=function(){if(!this.transformData)if(this.hasTransform()){var t=this.parseBounds(),e=this.prefixedCss("transformOrigin").split(" ").map(function(t){return t.replace("px","")}).map(function(t){return parseFloat(t)});e[0]+=t.left,e[1]+=t.top,this.transformData={origin:e,matrix:this.parseTransformMatrix()}}else this.transformData={origin:[0,0],matrix:[1,0,0,1,0,0]};return this.transformData},i.prototype.parseTransformMatrix=function(){if(!this.transformMatrix){var t=this.prefixedCss("transform"),e=t?function(t){if(t&&"matrix"===t[1])return t[2].split(",").map(function(t){return parseFloat(t.trim())});if(t&&"matrix3d"===t[1]){var e=t[2].split(",").map(function(t){return parseFloat(t.trim())});return[e[0],e[1],e[4],e[5],e[12],e[13]]}}(t.match(this.MATRIX_PROPERTY)):null;this.transformMatrix=e||[1,0,0,1,0,0]}return this.transformMatrix},i.prototype.parseBounds=function(){return this.bounds||(this.bounds=this.hasTransform()?u(this.node):s(this.node))},i.prototype.hasTransform=function(){return"1,0,0,1,0,0"!==this.parseTransformMatrix().join(",")||this.parent&&this.parent.hasTransform()},i.prototype.getValue=function(){var t=this.node.value||"";return"SELECT"===this.node.tagName?t=function(t){var e=t.options[t.selectedIndex||0];return e?e.text||"":""}(this.node):"password"===this.node.type&&(t=Array(t.length+1).join("•")),0===t.length?this.node.placeholder||"":t},i.prototype.MATRIX_PROPERTY=/(matrix|matrix3d)\((.+)\)/,i.prototype.TEXT_SHADOW_PROPERTY=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,i.prototype.TEXT_SHADOW_VALUES=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,i.prototype.CLIP=/^rect\((\d+)px,? (\d+)px,? (\d+)px,? (\d+)px\)$/,e.exports=i},{"./color":3,"./utils":26}],15:[function(t,e,n){function i(t,e,n,i,r){k("Starting NodeParser"),this.renderer=e,this.options=r,this.range=null,this.support=n,this.renderQueue=[],this.stack=new C(!0,1,t.ownerDocument,null);var o=new E(t,null);if(r.background&&e.rectangle(0,0,e.width,e.height,new I(r.background)),t===t.ownerDocument.documentElement){var a=new E(o.color("backgroundColor").isTransparent()?t.ownerDocument.body:t.ownerDocument.documentElement,null);e.rectangle(0,0,e.width,e.height,a.color("backgroundColor"))}o.visibile=o.isElementVisible(),this.createPseudoHideStyles(t.ownerDocument),this.disableAnimations(t.ownerDocument),this.nodes=x([o].concat(this.getChildren(o)).filter(function(t){return t.visible=t.isElementVisible()}).map(this.getPseudoElements,this)),this.fontMetrics=new R,k("Fetched nodes, total:",this.nodes.length),k("Calculate overflow clips"),this.calculateOverflowClips(),k("Start fetching images"),this.images=i.fetch(this.nodes.filter(y)),this.ready=this.images.ready.then(D(function(){return k("Images loaded, starting parsing"),k("Creating stacking contexts"),this.createStackingContexts(),k("Sorting stacking contexts"),this.sortStackingContexts(this.stack),this.parse(this.stack),k("Render queue created with "+this.renderQueue.length+" items"),new Promise(D(function(t){r.async?"function"==typeof r.async?r.async.call(this,this.renderQueue,t):this.renderQueue.length>0?(this.renderIndex=0,this.asyncRenderer(this.renderQueue,t)):t():(this.renderQueue.forEach(this.paint,this),t())},this))},this))}function r(t){return t.parent&&t.parent.clip.length}function o(){}function a(t,e,n,i){return t.map(function(r,o){if(r.width>0){var a=e.left,s=e.top,c=e.width,u=e.height-t[2].width;switch(o){case 0:u=t[0].width,r.args=l({c1:[a,s],c2:[a+c,s],c3:[a+c-t[1].width,s+u],c4:[a+t[3].width,s+u]},i[0],i[1],n.topLeftOuter,n.topLeftInner,n.topRightOuter,n.topRightInner);break;case 1:a=e.left+e.width-t[1].width,c=t[1].width,r.args=l({c1:[a+c,s],c2:[a+c,s+u+t[2].width],c3:[a,s+u],c4:[a,s+t[0].width]},i[1],i[2],n.topRightOuter,n.topRightInner,n.bottomRightOuter,n.bottomRightInner);break;case 2:s=s+e.height-t[2].width,u=t[2].width,r.args=l({c1:[a+c,s+u],c2:[a,s+u],c3:[a+t[3].width,s],c4:[a+c-t[3].width,s]},i[2],i[3],n.bottomRightOuter,n.bottomRightInner,n.bottomLeftOuter,n.bottomLeftInner);break;case 3:c=t[3].width,r.args=l({c1:[a,s+u+t[2].width],c2:[a,s],c3:[a+c,s+t[0].width],c4:[a+c,s+u]},i[3],i[0],n.bottomLeftOuter,n.bottomLeftInner,n.topLeftOuter,n.topLeftInner)}}return r})}function s(t,e,n,i){var r=(Math.sqrt(2)-1)/3*4,o=n*r,a=i*r,s=t+n,c=e+i;return{topLeft:u({x:t,y:c},{x:t,y:c-a},{x:s-o,y:e},{x:s,y:e}),topRight:u({x:t,y:e},{x:t+o,y:e},{x:s,y:c-a},{x:s,y:c}),bottomRight:u({x:s,y:e},{x:s,y:e+a},{x:t+o,y:c},{x:t,y:c}),bottomLeft:u({x:s,y:c},{x:s-o,y:c},{x:t,y:e+a},{x:t,y:e})}}function c(t,e,n){var i=t.left,r=t.top,o=t.width,a=t.height,c=e[0][0]<o/2?e[0][0]:o/2,u=e[0][1]<a/2?e[0][1]:a/2,l=e[1][0]<o/2?e[1][0]:o/2,d=e[1][1]<a/2?e[1][1]:a/2,h=e[2][0]<o/2?e[2][0]:o/2,p=e[2][1]<a/2?e[2][1]:a/2,f=e[3][0]<o/2?e[3][0]:o/2,g=e[3][1]<a/2?e[3][1]:a/2,m=o-l,v=a-p,y=o-h,b=a-g;return{topLeftOuter:s(i,r,c,u).topLeft.subdivide(.5),topLeftInner:s(i+n[3].width,r+n[0].width,Math.max(0,c-n[3].width),Math.max(0,u-n[0].width)).topLeft.subdivide(.5),topRightOuter:s(i+m,r,l,d).topRight.subdivide(.5),topRightInner:s(i+Math.min(m,o+n[3].width),r+n[0].width,m>o+n[3].width?0:l-n[3].width,d-n[0].width).topRight.subdivide(.5),bottomRightOuter:s(i+y,r+v,h,p).bottomRight.subdivide(.5),bottomRightInner:s(i+Math.min(y,o-n[3].width),r+Math.min(v,a+n[0].width),Math.max(0,h-n[1].width),p-n[2].width).bottomRight.subdivide(.5),bottomLeftOuter:s(i,r+b,f,g).bottomLeft.subdivide(.5),bottomLeftInner:s(i+n[3].width,r+b,Math.max(0,f-n[3].width),g-n[2].width).bottomLeft.subdivide(.5)}}function u(t,e,n,i){var r=function(t,e,n){return{x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}};return{start:t,startControl:e,endControl:n,end:i,subdivide:function(o){var a=r(t,e,o),s=r(e,n,o),c=r(n,i,o),l=r(a,s,o),d=r(s,c,o),h=r(l,d,o);return[u(t,a,l,h),u(h,d,c,i)]},curveTo:function(t){t.push(["bezierCurve",e.x,e.y,n.x,n.y,i.x,i.y])},curveToReversed:function(i){i.push(["bezierCurve",n.x,n.y,e.x,e.y,t.x,t.y])}}}function l(t,e,n,i,r,o,a){var s=[];return e[0]>0||e[1]>0?(s.push(["line",i[1].start.x,i[1].start.y]),i[1].curveTo(s)):s.push(["line",t.c1[0],t.c1[1]]),n[0]>0||n[1]>0?(s.push(["line",o[0].start.x,o[0].start.y]),o[0].curveTo(s),s.push(["line",a[0].end.x,a[0].end.y]),a[0].curveToReversed(s)):(s.push(["line",t.c2[0],t.c2[1]]),s.push(["line",t.c3[0],t.c3[1]])),e[0]>0||e[1]>0?(s.push(["line",r[1].end.x,r[1].end.y]),r[1].curveToReversed(s)):s.push(["line",t.c4[0],t.c4[1]]),s}function d(t,e,n,i,r,o,a){e[0]>0||e[1]>0?(t.push(["line",i[0].start.x,i[0].start.y]),i[0].curveTo(t),i[1].curveTo(t)):t.push(["line",o,a]),(n[0]>0||n[1]>0)&&t.push(["line",r[0].start.x,r[0].start.y])}function h(t){return 0===t.cssInt("zIndex")}function p(t){return-1!==["inline","inline-block","inline-table"].indexOf(t.css("display"))}function f(t){return t instanceof C}function g(t){return"static"!==t.css("position")}function m(t){return"none"!==t.css("float")}function v(t){var e=this;return function(){return!t.apply(e,arguments)}}function y(t){return t.node.nodeType===Node.ELEMENT_NODE}function b(t){return!0===t.isPseudoElement}function w(t){return t.node.nodeType===Node.TEXT_NODE}function x(t){return[].concat.apply([],t)}var k=t("./log"),_=t("punycode"),E=t("./nodecontainer"),T=t("./textcontainer"),S=t("./pseudoelementcontainer"),R=t("./fontmetrics"),I=t("./color"),C=t("./stackingcontext"),O=t("./utils"),D=O.bind,A=O.getBounds,L=O.parseBackgrounds,P=O.offsetBounds;i.prototype.calculateOverflowClips=function(){this.nodes.forEach(function(t){if(y(t)){b(t)&&t.appendToDOM(),t.borders=this.parseBorders(t);var e="hidden"===t.css("overflow")?[t.borders.clip]:[],n=t.parseClip();n&&-1!==["absolute","fixed"].indexOf(t.css("position"))&&e.push([["rect",t.bounds.left+n.left,t.bounds.top+n.top,n.right-n.left,n.bottom-n.top]]),t.clip=r(t)?t.parent.clip.concat(e):e,t.backgroundClip="hidden"!==t.css("overflow")?t.clip.concat([t.borders.clip]):t.clip,b(t)&&t.cleanDOM()}else w(t)&&(t.clip=r(t)?t.parent.clip:[]);b(t)||(t.bounds=null)},this)},i.prototype.asyncRenderer=function(t,e,n){n=n||Date.now(),this.paint(t[this.renderIndex++]),t.length===this.renderIndex?e():n+20>Date.now()?this.asyncRenderer(t,e,n):setTimeout(D(function(){this.asyncRenderer(t,e)},this),0)},i.prototype.createPseudoHideStyles=function(t){this.createStyles(t,"."+S.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+':before { content: "" !important; display: none !important; }.'+S.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER+':after { content: "" !important; display: none !important; }')},i.prototype.disableAnimations=function(t){this.createStyles(t,"* { -webkit-animation: none !important; -moz-animation: none !important; -o-animation: none !important; animation: none !important; -webkit-transition: none !important; -moz-transition: none !important; -o-transition: none !important; transition: none !important;}")},i.prototype.createStyles=function(t,e){var n=t.createElement("style");n.innerHTML=e,t.body.appendChild(n)},i.prototype.getPseudoElements=function(t){var e=[[t]];if(t.node.nodeType===Node.ELEMENT_NODE){var n=this.getPseudoElement(t,":before"),i=this.getPseudoElement(t,":after");n&&e.push(n),i&&e.push(i)}return x(e)},i.prototype.getPseudoElement=function(t,e){var n=t.computedStyle(e);if(!n||!n.content||"none"===n.content||"-moz-alt-content"===n.content||"none"===n.display)return null;for(var i=function(t){var e=t.substr(0,1);return e===t.substr(t.length-1)&&e.match(/'|"/)?t.substr(1,t.length-2):t}(n.content),r="url"===i.substr(0,3),o=document.createElement(r?"img":"html2canvaspseudoelement"),a=new S(o,t,e),s=n.length-1;s>=0;s--){var c=function(t){return t.replace(/(\-[a-z])/g,function(t){return t.toUpperCase().replace("-","")})}(n.item(s));o.style[c]=n[c]}if(o.className=S.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE+" "+S.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER,r)return o.src=L(i)[0].args[0],[a];var u=document.createTextNode(i);return o.appendChild(u),[a,new T(u,a)]},i.prototype.getChildren=function(t){return x([].filter.call(t.node.childNodes,function(t){return t.nodeType===Node.TEXT_NODE||t.nodeType===Node.ELEMENT_NODE}).map(function(e){var n=[e.nodeType===Node.TEXT_NODE?new T(e,t):new E(e,t)].filter(function(t){return t.node.nodeType!==Node.ELEMENT_NODE||-1===["SCRIPT","HEAD","TITLE","OBJECT","BR","OPTION"].indexOf(t.node.nodeName)});return e.nodeType===Node.ELEMENT_NODE&&n.length&&"TEXTAREA"!==e.tagName?n[0].isElementVisible()?n.concat(this.getChildren(n[0])):[]:n},this))},i.prototype.newStackingContext=function(t,e){var n=new C(e,t.getOpacity(),t.node,t.parent);t.cloneTo(n);(e?n.getParentStack(this):n.parent.stack).contexts.push(n),t.stack=n},i.prototype.createStackingContexts=function(){this.nodes.forEach(function(t){y(t)&&(this.isRootElement(t)||function(t){return t.getOpacity()<1}(t)||function(t){var e=t.css("position");return"auto"!==(-1!==["absolute","relative","fixed"].indexOf(e)?t.css("zIndex"):"auto")}(t)||this.isBodyWithTransparentRoot(t)||t.hasTransform())?this.newStackingContext(t,!0):y(t)&&(g(t)&&h(t)||function(t){return-1!==["inline-block","inline-table"].indexOf(t.css("display"))}(t)||m(t))?this.newStackingContext(t,!1):t.assignStack(t.parent.stack)},this)},i.prototype.isBodyWithTransparentRoot=function(t){return"BODY"===t.node.nodeName&&t.parent.color("backgroundColor").isTransparent()},i.prototype.isRootElement=function(t){return null===t.parent},i.prototype.sortStackingContexts=function(t){t.contexts.sort(function(t){return function(e,n){return e.cssInt("zIndex")+t.indexOf(e)/t.length-(n.cssInt("zIndex")+t.indexOf(n)/t.length)}}(t.contexts.slice(0))),t.contexts.forEach(this.sortStackingContexts,this)},i.prototype.parseTextBounds=function(t){return function(e,n,i){if("none"!==t.parent.css("textDecoration").substr(0,4)||0!==e.trim().length){if(this.support.rangeBounds&&!t.parent.hasTransform()){var r=i.slice(0,n).join("").length;return this.getRangeBounds(t.node,r,e.length)}if(t.node&&"string"==typeof t.node.data){var o=t.node.splitText(e.length),a=this.getWrapperBounds(t.node,t.parent.hasTransform());return t.node=o,a}}else this.support.rangeBounds&&!t.parent.hasTransform()||(t.node=t.node.splitText(e.length));return{}}},i.prototype.getWrapperBounds=function(t,e){var n=t.ownerDocument.createElement("html2canvaswrapper"),i=t.parentNode,r=t.cloneNode(!0);n.appendChild(t.cloneNode(!0)),i.replaceChild(n,t);var o=e?P(n):A(n);return i.replaceChild(r,n),o},i.prototype.getRangeBounds=function(t,e,n){var i=this.range||(this.range=t.ownerDocument.createRange());return i.setStart(t,e),i.setEnd(t,e+n),i.getBoundingClientRect()},i.prototype.parse=function(t){var e=t.contexts.filter(function(t){return t.cssInt("zIndex")<0}),n=t.children.filter(y),i=n.filter(v(m)),r=i.filter(v(g)).filter(v(p)),a=n.filter(v(g)).filter(m),s=i.filter(v(g)).filter(p),c=t.contexts.concat(i.filter(g)).filter(h),u=t.children.filter(w).filter(function(t){return t.node.data.trim().length>0}),l=t.contexts.filter(function(t){return t.cssInt("zIndex")>0});e.concat(r).concat(a).concat(s).concat(c).concat(u).concat(l).forEach(function(t){this.renderQueue.push(t),f(t)&&(this.parse(t),this.renderQueue.push(new o))},this)},i.prototype.paint=function(t){try{t instanceof o?this.renderer.ctx.restore():w(t)?(b(t.parent)&&t.parent.appendToDOM(),this.paintText(t),b(t.parent)&&t.parent.cleanDOM()):this.paintNode(t)}catch(t){if(k(t),this.options.strict)throw t}},i.prototype.paintNode=function(t){f(t)&&(this.renderer.setOpacity(t.opacity),this.renderer.ctx.save(),t.hasTransform()&&this.renderer.setTransform(t.parseTransform())),"INPUT"===t.node.nodeName&&"checkbox"===t.node.type?this.paintCheckbox(t):"INPUT"===t.node.nodeName&&"radio"===t.node.type?this.paintRadio(t):this.paintElement(t)},i.prototype.paintElement=function(t){var e=t.parseBounds();this.renderer.clip(t.backgroundClip,function(){this.renderer.renderBackground(t,e,t.borders.borders.map(function(t){return t.width}))},this),this.renderer.clip(t.clip,function(){this.renderer.renderBorders(t.borders.borders)},this),this.renderer.clip(t.backgroundClip,function(){switch(t.node.nodeName){case"svg":case"IFRAME":var n=this.images.get(t.node);n?this.renderer.renderImage(t,e,t.borders,n):k("Error loading <"+t.node.nodeName+">",t.node);break;case"IMG":var i=this.images.get(t.node.src);i?this.renderer.renderImage(t,e,t.borders,i):k("Error loading <img>",t.node.src);break;case"CANVAS":this.renderer.renderImage(t,e,t.borders,{image:t.node});break;case"SELECT":case"INPUT":case"TEXTAREA":this.paintFormValue(t)}},this)},i.prototype.paintCheckbox=function(t){var e=t.parseBounds(),n=Math.min(e.width,e.height),i={width:n-1,height:n-1,top:e.top,left:e.left},r=[3,3],o=[r,r,r,r],s=[1,1,1,1].map(function(t){return{color:new I("#A5A5A5"),width:t}}),u=c(i,o,s);this.renderer.clip(t.backgroundClip,function(){this.renderer.rectangle(i.left+1,i.top+1,i.width-2,i.height-2,new I("#DEDEDE")),this.renderer.renderBorders(a(s,i,u,o)),t.node.checked&&(this.renderer.font(new I("#424242"),"normal","normal","bold",n-3+"px","arial"),this.renderer.text("✔",i.left+n/6,i.top+n-1))},this)},i.prototype.paintRadio=function(t){var e=t.parseBounds(),n=Math.min(e.width,e.height)-2;this.renderer.clip(t.backgroundClip,function(){this.renderer.circleStroke(e.left+1,e.top+1,n,new I("#DEDEDE"),1,new I("#A5A5A5")),t.node.checked&&this.renderer.circle(Math.ceil(e.left+n/4)+1,Math.ceil(e.top+n/4)+1,Math.floor(n/2),new I("#424242"))},this)},i.prototype.paintFormValue=function(t){var e=t.getValue();if(e.length>0){var n=t.node.ownerDocument,i=n.createElement("html2canvaswrapper");["lineHeight","textAlign","fontFamily","fontWeight","fontSize","color","paddingLeft","paddingTop","paddingRight","paddingBottom","width","height","borderLeftStyle","borderTopStyle","borderLeftWidth","borderTopWidth","boxSizing","whiteSpace","wordWrap"].forEach(function(e){try{i.style[e]=t.css(e)}catch(t){k("html2canvas: Parse: Exception caught in renderFormValue: "+t.message)}});var r=t.parseBounds();i.style.position="fixed",i.style.left=r.left+"px",i.style.top=r.top+"px",i.textContent=e,n.body.appendChild(i),this.paintText(new T(i.firstChild,t)),n.body.removeChild(i)}},i.prototype.paintText=function(t){t.applyTextTransform();var e=_.ucs2.decode(t.node.data),n=this.options.letterRendering&&!function(t){return/^(normal|none|0px)$/.test(t.parent.css("letterSpacing"))}(t)||function(t){return/[^\u0000-\u00ff]/.test(t)}(t.node.data)?e.map(function(t){return _.ucs2.encode([t])}):function(t){for(var e,n=[],i=0,r=!1;t.length;)(function(t){return-1!==[32,13,10,9,45].indexOf(t)})(t[i])===r?((e=t.splice(0,i)).length&&n.push(_.ucs2.encode(e)),r=!r,i=0):i++,i>=t.length&&(e=t.splice(0,i)).length&&n.push(_.ucs2.encode(e));return n}(e),i=t.parent.fontWeight(),r=t.parent.css("fontSize"),o=t.parent.css("fontFamily"),a=t.parent.parseTextShadows();this.renderer.font(t.parent.color("color"),t.parent.css("fontStyle"),t.parent.css("fontVariant"),i,r,o),a.length?this.renderer.fontShadow(a[0].color,a[0].offsetX,a[0].offsetY,a[0].blur):this.renderer.clearShadow(),this.renderer.clip(t.parent.clip,function(){n.map(this.parseTextBounds(t),this).forEach(function(e,i){e&&(this.renderer.text(n[i],e.left,e.bottom),this.renderTextDecoration(t.parent,e,this.fontMetrics.getMetrics(o,r)))},this)},this)},i.prototype.renderTextDecoration=function(t,e,n){switch(t.css("textDecoration").split(" ")[0]){case"underline":this.renderer.rectangle(e.left,Math.round(e.top+n.baseline+n.lineWidth),e.width,1,t.color("color"));break;case"overline":this.renderer.rectangle(e.left,Math.round(e.top),e.width,1,t.color("color"));break;case"line-through":this.renderer.rectangle(e.left,Math.ceil(e.top+n.middle+n.lineWidth),e.width,1,t.color("color"))}};var B={inset:[["darken",.6],["darken",.1],["darken",.1],["darken",.6]]};i.prototype.parseBorders=function(t){var e=t.parseBounds(),n=function(t){return["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(e){var n=t.css("border"+e+"Radius").split(" ");return n.length<=1&&(n[1]=n[0]),n.map(function(t){return parseInt(t,10)})})}(t),i=["Top","Right","Bottom","Left"].map(function(e,n){var i=t.css("border"+e+"Style"),r=t.color("border"+e+"Color");"inset"===i&&r.isBlack()&&(r=new I([255,255,255,r.a]));var o=B[i]?B[i][n]:null;return{width:t.cssInt("border"+e+"Width"),color:o?r[o[0]](o[1]):r,args:null}}),r=c(e,n,i);return{clip:this.parseBackgroundClip(t,r,i,n,e),borders:a(i,e,r,n)}},i.prototype.parseBackgroundClip=function(t,e,n,i,r){var o=[];switch(t.css("backgroundClip")){case"content-box":case"padding-box":d(o,i[0],i[1],e.topLeftInner,e.topRightInner,r.left+n[3].width,r.top+n[0].width),d(o,i[1],i[2],e.topRightInner,e.bottomRightInner,r.left+r.width-n[1].width,r.top+n[0].width),d(o,i[2],i[3],e.bottomRightInner,e.bottomLeftInner,r.left+r.width-n[1].width,r.top+r.height-n[2].width),d(o,i[3],i[0],e.bottomLeftInner,e.topLeftInner,r.left+n[3].width,r.top+r.height-n[2].width);break;default:d(o,i[0],i[1],e.topLeftOuter,e.topRightOuter,r.left,r.top),d(o,i[1],i[2],e.topRightOuter,e.bottomRightOuter,r.left+r.width,r.top),d(o,i[2],i[3],e.bottomRightOuter,e.bottomLeftOuter,r.left+r.width,r.top+r.height),d(o,i[3],i[0],e.bottomLeftOuter,e.topLeftOuter,r.left,r.top+r.height)}return o},e.exports=i},{"./color":3,"./fontmetrics":7,"./log":13,"./nodecontainer":14,"./pseudoelementcontainer":18,"./stackingcontext":21,"./textcontainer":25,"./utils":26,punycode:1}],16:[function(t,e,n){function i(t,e,n){var i="withCredentials"in new XMLHttpRequest;if(!e)return Promise.reject("No proxy configured");var s=o(i),u=a(e,t,s);return i?c(u):r(n,u,s).then(function(t){return h(t.content)})}function r(t,e,n){return new Promise(function(i,r){var o=t.createElement("script"),a=function(){delete window.html2canvas.proxy[n],t.body.removeChild(o)};window.html2canvas.proxy[n]=function(t){a(),i(t)},o.src=e,o.onerror=function(t){a(),r(t)},t.body.appendChild(o)})}function o(t){return t?"":"html2canvas_"+Date.now()+"_"+ ++p+"_"+Math.round(1e5*Math.random())}function a(t,e,n){return t+"?url="+encodeURIComponent(e)+(n.length?"&callback=html2canvas.proxy."+n:"")}function s(t){return function(e){var n,i=new DOMParser;try{n=i.parseFromString(e,"text/html")}catch(t){l("DOMParser not supported, falling back to createHTMLDocument"),n=document.implementation.createHTMLDocument("");try{n.open(),n.write(e),n.close()}catch(t){l("createHTMLDocument write not supported, falling back to document.body.innerHTML"),n.body.innerHTML=e}}var r=n.querySelector("base");if(!r||!r.href.host){var o=n.createElement("base");o.href=t,n.head.insertBefore(o,n.head.firstChild)}return n}}var c=t("./xhr"),u=t("./utils"),l=t("./log"),d=t("./clone"),h=u.decode64,p=0;n.Proxy=i,n.ProxyURL=function(t,e,n){var i="crossOrigin"in new Image,s=o(i),c=a(e,t,s);return i?Promise.resolve(c):r(n,c,s).then(function(t){return"data:"+t.type+";base64,"+t.content})},n.loadUrlDocument=function(t,e,n,r,o,a){return new i(t,e,window.document).then(s(t)).then(function(t){return d(t,n,r,o,a,0,0)})}},{"./clone":2,"./log":13,"./utils":26,"./xhr":28}],17:[function(t,e,n){var i=t("./proxy").ProxyURL;e.exports=function(t,e){var n=document.createElement("a");n.href=t,t=n.href,this.src=t,this.image=new Image;var r=this;this.promise=new Promise(function(n,o){r.image.crossOrigin="Anonymous",r.image.onload=n,r.image.onerror=o,new i(t,e,document).then(function(t){r.image.src=t}).catch(o)})}},{"./proxy":16}],18:[function(t,e,n){function i(t,e,n){r.call(this,t,e),this.isPseudoElement=!0,this.before=":before"===n}var r=t("./nodecontainer");i.prototype.cloneTo=function(t){i.prototype.cloneTo.call(this,t),t.isPseudoElement=!0,t.before=this.before},(i.prototype=Object.create(r.prototype)).appendToDOM=function(){this.before?this.parent.node.insertBefore(this.node,this.parent.node.firstChild):this.parent.node.appendChild(this.node),this.parent.node.className+=" "+this.getHideClass()},i.prototype.cleanDOM=function(){this.node.parentNode.removeChild(this.node),this.parent.node.className=this.parent.node.className.replace(this.getHideClass(),"")},i.prototype.getHideClass=function(){return this["PSEUDO_HIDE_ELEMENT_CLASS_"+(this.before?"BEFORE":"AFTER")]},i.prototype.PSEUDO_HIDE_ELEMENT_CLASS_BEFORE="___html2canvas___pseudoelement_before",i.prototype.PSEUDO_HIDE_ELEMENT_CLASS_AFTER="___html2canvas___pseudoelement_after",e.exports=i},{"./nodecontainer":14}],19:[function(t,e,n){function i(t,e,n,i,r){this.width=t,this.height=e,this.images=n,this.options=i,this.document=r}var r=t("./log");i.prototype.renderImage=function(t,e,n,i){var r=t.cssInt("paddingLeft"),o=t.cssInt("paddingTop"),a=t.cssInt("paddingRight"),s=t.cssInt("paddingBottom"),c=n.borders,u=e.width-(c[1].width+c[3].width+r+a),l=e.height-(c[0].width+c[2].width+o+s);this.drawImage(i,0,0,i.image.width||u,i.image.height||l,e.left+r+c[3].width,e.top+o+c[0].width,u,l)},i.prototype.renderBackground=function(t,e,n){e.height>0&&e.width>0&&(this.renderBackgroundColor(t,e),this.renderBackgroundImage(t,e,n))},i.prototype.renderBackgroundColor=function(t,e){var n=t.color("backgroundColor");n.isTransparent()||this.rectangle(e.left,e.top,e.width,e.height,n)},i.prototype.renderBorders=function(t){t.forEach(this.renderBorder,this)},i.prototype.renderBorder=function(t){t.color.isTransparent()||null===t.args||this.drawShape(t.args,t.color)},i.prototype.renderBackgroundImage=function(t,e,n){t.parseBackgroundImages().reverse().forEach(function(i,o,a){switch(i.method){case"url":var s=this.images.get(i.args[0]);s?this.renderBackgroundRepeating(t,e,s,a.length-(o+1),n):r("Error loading background-image",i.args[0]);break;case"linear-gradient":case"gradient":var c=this.images.get(i.value);c?this.renderBackgroundGradient(c,e,n):r("Error loading background-image",i.args[0]);break;case"none":break;default:r("Unknown background-image type",i.args[0])}},this)},i.prototype.renderBackgroundRepeating=function(t,e,n,i,r){var o=t.parseBackgroundSize(e,n.image,i),a=t.parseBackgroundPosition(e,n.image,i,o);switch(t.parseBackgroundRepeat(i)){case"repeat-x":case"repeat no-repeat":this.backgroundRepeatShape(n,a,o,e,e.left+r[3],e.top+a.top+r[0],99999,o.height,r);break;case"repeat-y":case"no-repeat repeat":this.backgroundRepeatShape(n,a,o,e,e.left+a.left+r[3],e.top+r[0],o.width,99999,r);break;case"no-repeat":this.backgroundRepeatShape(n,a,o,e,e.left+a.left+r[3],e.top+a.top+r[0],o.width,o.height,r);break;default:this.renderBackgroundRepeat(n,a,o,{top:e.top,left:e.left},r[3],r[0])}},e.exports=i},{"./log":13}],20:[function(t,e,n){function i(t,e){r.apply(this,arguments),this.canvas=this.options.canvas||this.document.createElement("canvas"),this.options.canvas||(this.canvas.width=t,this.canvas.height=e),this.ctx=this.canvas.getContext("2d"),this.taintCtx=this.document.createElement("canvas").getContext("2d"),this.ctx.textBaseline="bottom",this.variables={},a("Initialized CanvasRenderer with size",t,"x",e)}var r=t("../renderer"),o=t("../lineargradientcontainer"),a=t("../log");(i.prototype=Object.create(r.prototype)).setFillStyle=function(t){return this.ctx.fillStyle="object"==typeof t&&t.isColor?t.toString():t,this.ctx},i.prototype.rectangle=function(t,e,n,i,r){this.setFillStyle(r).fillRect(t,e,n,i)},i.prototype.circle=function(t,e,n,i){this.setFillStyle(i),this.ctx.beginPath(),this.ctx.arc(t+n/2,e+n/2,n/2,0,2*Math.PI,!0),this.ctx.closePath(),this.ctx.fill()},i.prototype.circleStroke=function(t,e,n,i,r,o){this.circle(t,e,n,i),this.ctx.strokeStyle=o.toString(),this.ctx.stroke()},i.prototype.drawShape=function(t,e){this.shape(t),this.setFillStyle(e).fill()},i.prototype.taints=function(t){if(null===t.tainted){this.taintCtx.drawImage(t.image,0,0);try{this.taintCtx.getImageData(0,0,1,1),t.tainted=!1}catch(e){this.taintCtx=document.createElement("canvas").getContext("2d"),t.tainted=!0}}return t.tainted},i.prototype.drawImage=function(t,e,n,i,r,o,a,s,c){this.taints(t)&&!this.options.allowTaint||this.ctx.drawImage(t.image,e,n,i,r,o,a,s,c)},i.prototype.clip=function(t,e,n){this.ctx.save(),t.filter(function(t){return t.length>0}).forEach(function(t){this.shape(t).clip()},this),e.call(n),this.ctx.restore()},i.prototype.shape=function(t){return this.ctx.beginPath(),t.forEach(function(t,e){"rect"===t[0]?this.ctx.rect.apply(this.ctx,t.slice(1)):this.ctx[0===e?"moveTo":t[0]+"To"].apply(this.ctx,t.slice(1))},this),this.ctx.closePath(),this.ctx},i.prototype.font=function(t,e,n,i,r,o){this.setFillStyle(t).font=[e,n,i,r,o].join(" ").split(",")[0]},i.prototype.fontShadow=function(t,e,n,i){this.setVariable("shadowColor",t.toString()).setVariable("shadowOffsetY",e).setVariable("shadowOffsetX",n).setVariable("shadowBlur",i)},i.prototype.clearShadow=function(){this.setVariable("shadowColor","rgba(0,0,0,0)")},i.prototype.setOpacity=function(t){this.ctx.globalAlpha=t},i.prototype.setTransform=function(t){this.ctx.translate(t.origin[0],t.origin[1]),this.ctx.transform.apply(this.ctx,t.matrix),this.ctx.translate(-t.origin[0],-t.origin[1])},i.prototype.setVariable=function(t,e){return this.variables[t]!==e&&(this.variables[t]=this.ctx[t]=e),this},i.prototype.text=function(t,e,n){this.ctx.fillText(t,e,n)},i.prototype.backgroundRepeatShape=function(t,e,n,i,r,o,a,s,c){var u=[["line",Math.round(r),Math.round(o)],["line",Math.round(r+a),Math.round(o)],["line",Math.round(r+a),Math.round(s+o)],["line",Math.round(r),Math.round(s+o)]];this.clip([u],function(){this.renderBackgroundRepeat(t,e,n,i,c[3],c[0])},this)},i.prototype.renderBackgroundRepeat=function(t,e,n,i,r,o){var a=Math.round(i.left+e.left+r),s=Math.round(i.top+e.top+o);this.setFillStyle(this.ctx.createPattern(this.resizeImage(t,n),"repeat")),this.ctx.translate(a,s),this.ctx.fill(),this.ctx.translate(-a,-s)},i.prototype.renderBackgroundGradient=function(t,e){if(t instanceof o){var n=this.ctx.createLinearGradient(e.left+e.width*t.x0,e.top+e.height*t.y0,e.left+e.width*t.x1,e.top+e.height*t.y1);t.colorStops.forEach(function(t){n.addColorStop(t.stop,t.color.toString())}),this.rectangle(e.left,e.top,e.width,e.height,n)}},i.prototype.resizeImage=function(t,e){var n=t.image;if(n.width===e.width&&n.height===e.height)return n;var i=document.createElement("canvas");return i.width=e.width,i.height=e.height,i.getContext("2d").drawImage(n,0,0,n.width,n.height,0,0,e.width,e.height),i},e.exports=i},{"../lineargradientcontainer":12,"../log":13,"../renderer":19}],21:[function(t,e,n){function i(t,e,n,i){r.call(this,n,i),this.ownStacking=t,this.contexts=[],this.children=[],this.opacity=(this.parent?this.parent.stack.opacity:1)*e}var r=t("./nodecontainer");(i.prototype=Object.create(r.prototype)).getParentStack=function(t){var e=this.parent?this.parent.stack:null;return e?e.ownStacking?e:e.getParentStack(t):t.stack},e.exports=i},{"./nodecontainer":14}],22:[function(t,e,n){function i(t){this.rangeBounds=this.testRangeBounds(t),this.cors=this.testCORS(),this.svg=this.testSVG()}i.prototype.testRangeBounds=function(t){var e,n,i=!1;return t.createRange&&(e=t.createRange()).getBoundingClientRect&&((n=t.createElement("boundtest")).style.height="123px",n.style.display="block",t.body.appendChild(n),e.selectNode(n),123===e.getBoundingClientRect().height&&(i=!0),t.body.removeChild(n)),i},i.prototype.testCORS=function(){return void 0!==(new Image).crossOrigin},i.prototype.testSVG=function(){var t=new Image,e=document.createElement("canvas"),n=e.getContext("2d");t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(t,0,0),e.toDataURL()}catch(t){return!1}return!0},e.exports=i},{}],23:[function(t,e,n){function i(t){this.src=t,this.image=null;var e=this;this.promise=this.hasFabric().then(function(){return e.isInline(t)?Promise.resolve(e.inlineFormatting(t)):r(t)}).then(function(t){return new Promise(function(n){window.html2canvas.svg.fabric.loadSVGFromString(t,e.createCanvas.call(e,n))})})}var r=t("./xhr"),o=t("./utils").decode64;i.prototype.hasFabric=function(){return window.html2canvas.svg&&window.html2canvas.svg.fabric?Promise.resolve():Promise.reject(new Error("html2canvas.svg.js is not loaded, cannot render svg"))},i.prototype.inlineFormatting=function(t){return/^data:image\/svg\+xml;base64,/.test(t)?this.decode64(this.removeContentType(t)):this.removeContentType(t)},i.prototype.removeContentType=function(t){return t.replace(/^data:image\/svg\+xml(;base64)?,/,"")},i.prototype.isInline=function(t){return/^data:image\/svg\+xml/i.test(t)},i.prototype.createCanvas=function(t){var e=this;return function(n,i){var r=new window.html2canvas.svg.fabric.StaticCanvas("c");e.image=r.lowerCanvasEl,r.setWidth(i.width).setHeight(i.height).add(window.html2canvas.svg.fabric.util.groupSVGElements(n,i)).renderAll(),t(r.lowerCanvasEl)}},i.prototype.decode64=function(t){return"function"==typeof window.atob?window.atob(t):o(t)},e.exports=i},{"./utils":26,"./xhr":28}],24:[function(t,e,n){function i(t,e){this.src=t,this.image=null;var n=this;this.promise=e?new Promise(function(e,i){n.image=new Image,n.image.onload=e,n.image.onerror=i,n.image.src="data:image/svg+xml,"+(new XMLSerializer).serializeToString(t),!0===n.image.complete&&e(n.image)}):this.hasFabric().then(function(){return new Promise(function(e){window.html2canvas.svg.fabric.parseSVGDocument(t,n.createCanvas.call(n,e))})})}var r=t("./svgcontainer");i.prototype=Object.create(r.prototype),e.exports=i},{"./svgcontainer":23}],25:[function(t,e,n){function i(t,e){r.call(this,t,e)}var r=t("./nodecontainer");(i.prototype=Object.create(r.prototype)).applyTextTransform=function(){this.node.data=this.transform(this.parent.css("textTransform"))},i.prototype.transform=function(t){var e=this.node.data;switch(t){case"lowercase":return e.toLowerCase();case"capitalize":return e.replace(/(^|\s|:|-|\(|\))([a-z])/g,function(t,e,n){if(t.length>0)return e+n.toUpperCase()});case"uppercase":return e.toUpperCase();default:return e}},e.exports=i},{"./nodecontainer":14}],26:[function(t,e,n){n.smallImage=function(){return"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"},n.bind=function(t,e){return function(){return t.apply(e,arguments)}},n.decode64=function(t){var e,n,i,r,o,a,s,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=t.length,l="";for(e=0;e<u;e+=4)o=c.indexOf(t[e])<<2|(n=c.indexOf(t[e+1]))>>4,a=(15&n)<<4|(i=c.indexOf(t[e+2]))>>2,s=(3&i)<<6|(r=c.indexOf(t[e+3])),l+=64===i?String.fromCharCode(o):64===r||-1===r?String.fromCharCode(o,a):String.fromCharCode(o,a,s);return l},n.getBounds=function(t){if(t.getBoundingClientRect){var e=t.getBoundingClientRect(),n=null==t.offsetWidth?e.width:t.offsetWidth;return{top:e.top,bottom:e.bottom||e.top+e.height,right:e.left+n,left:e.left,width:n,height:null==t.offsetHeight?e.height:t.offsetHeight}}return{}},n.offsetBounds=function(t){var e=t.offsetParent?n.offsetBounds(t.offsetParent):{top:0,left:0};return{top:t.offsetTop+e.top,bottom:t.offsetTop+t.offsetHeight+e.top,right:t.offsetLeft+e.left+t.offsetWidth,left:t.offsetLeft+e.left,width:t.offsetWidth,height:t.offsetHeight}},n.parseBackgrounds=function(t){var e,n,i,r,o,a,s,c=[],u=0,l=0,d=function(){e&&('"'===n.substr(0,1)&&(n=n.substr(1,n.length-2)),n&&s.push(n),"-"===e.substr(0,1)&&(r=e.indexOf("-",1)+1)>0&&(i=e.substr(0,r),e=e.substr(r)),c.push({prefix:i,method:e.toLowerCase(),value:o,args:s,image:null})),s=[],e=i=n=o=""};return s=[],e=i=n=o="",t.split("").forEach(function(t){if(!(0===u&&" \r\n\t".indexOf(t)>-1)){switch(t){case'"':a?a===t&&(a=null):a=t;break;case"(":if(a)break;if(0===u)return u=1,void(o+=t);l++;break;case")":if(a)break;if(1===u){if(0===l)return u=0,o+=t,void d();l--}break;case",":if(a)break;if(0===u)return void d();if(1===u&&0===l&&!e.match(/^url$/i))return s.push(n),n="",void(o+=t)}o+=t,0===u?e+=t:n+=t}}),d(),c}},{}],27:[function(t,e,n){function i(t){r.apply(this,arguments),this.type="linear"===t.args[0]?r.TYPES.LINEAR:r.TYPES.RADIAL}var r=t("./gradientcontainer");i.prototype=Object.create(r.prototype),e.exports=i},{"./gradientcontainer":9}],28:[function(t,e,n){e.exports=function(t){return new Promise(function(e,n){var i=new XMLHttpRequest;i.open("GET",t),i.onload=function(){200===i.status?e(i.responseText):n(new Error(i.statusText))},i.onerror=function(){n(new Error("Network Error"))},i.send()})}},{}]},{},[4])(4)}),function(t,e){var n,i={},r=function(t,e){var n,i,r;if("string"==typeof t)return a(t);for(n=[],i=t.length,r=0;r<i;r++)n.push(a(t[r]));return e.apply(null,n)},o=function(t,e,n){var o,a={exports:e};"function"==typeof e&&(n.length||(n=[r,a.exports,a]),void 0!==(o=e.apply(null,n))&&(a.exports=o)),i[t]=a.exports},a=function(e){var n=i[e]||t[e];if(!n)throw new Error("`"+e+"` is undefined");return n},s=function(e){return t.__dollar=e,function(t){var e,n,r,o,a,s;s=function(t){return t&&t.charAt(0).toUpperCase()+t.substr(1)};for(e in i)if(n=t,i.hasOwnProperty(e)){for(a=s((r=e.split("/")).pop());o=s(r.shift());)n[o]=n[o]||{},n=n[o];n[a]=i[e]}return t}(function(t,e,n){return e("dollar-third",[],function(){var e=t.require,n=t.__dollar||t.jQuery||t.Zepto||e("jquery")||e("zepto");if(!n)throw new Error("jQuery or Zepto not found!");return n}),e("dollar",["dollar-third"],function(t){return t}),e("promise-third",["dollar"],function(t){return{Deferred:t.Deferred,when:t.when,isPromise:function(t){return t&&"function"==typeof t.then}}}),e("promise",["promise-third"],function(t){return t}),e("base",["dollar","promise"],function(e,n){function i(t,e){return function(){return t.apply(e,arguments)}}var r=function(){},o=Function.call;return{version:"0.1.6",$:e,Deferred:n.Deferred,isPromise:n.isPromise,when:n.when,browser:function(t){var e={},n=t.match(/WebKit\/([\d.]+)/),i=t.match(/Chrome\/([\d.]+)/)||t.match(/CriOS\/([\d.]+)/),r=t.match(/MSIE\s([\d\.]+)/)||t.match(/(?:trident)(?:.*rv:([\w.]+))?/i),o=t.match(/Firefox\/([\d.]+)/),a=t.match(/Safari\/([\d.]+)/),s=t.match(/OPR\/([\d.]+)/);return n&&(e.webkit=parseFloat(n[1])),i&&(e.chrome=parseFloat(i[1])),r&&(e.ie=parseFloat(r[1])),o&&(e.firefox=parseFloat(o[1])),a&&(e.safari=parseFloat(a[1])),s&&(e.opera=parseFloat(s[1])),e}(navigator.userAgent),os:function(t){var e={},n=t.match(/(?:Android);?[\s\/]+([\d.]+)?/),i=t.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return n&&(e.android=parseFloat(n[1])),i&&(e.ios=parseFloat(i[1].replace(/_/g,"."))),e}(navigator.userAgent),inherits:function(t,n,i){var r;return"function"==typeof n?(r=n,n=null):r=n&&n.hasOwnProperty("constructor")?n.constructor:function(){return t.apply(this,arguments)},e.extend(!0,r,t,i||{}),r.__super__=t.prototype,r.prototype=function(t){var e;return Object.create?Object.create(t):(e=function(){},e.prototype=t,new e)}(t.prototype),n&&e.extend(!0,r.prototype,n),r},noop:r,bindFn:i,log:t.console?i(console.log,console):r,nextTick:function(t){setTimeout(t,1)},slice:function(t){return function(){return o.apply(t,arguments)}}([].slice),guid:function(){var t=0;return function(e){for(var n=(+new Date).toString(32),i=0;i<5;i++)n+=Math.floor(65535*Math.random()).toString(32);return(e||"wu_")+n+(t++).toString(32)}}(),formatSize:function(t,e,n){var i;for(n=n||["B","K","M","G","TB"];(i=n.shift())&&t>1024;)t/=1024;return("B"===i?t:t.toFixed(e||2))+i}}}),e("mediator",["base"],function(t){function e(t,e,n,i){return o.grep(t,function(t){return t&&(!e||t.e===e)&&(!n||t.cb===n||t.cb._cb===n)&&(!i||t.ctx===i)})}function n(t,e,n){o.each((t||"").split(s),function(t,i){n(i,e)})}function i(t,e){for(var n,i=!1,r=-1,o=t.length;++r<o;)if(!1===(n=t[r]).cb.apply(n.ctx2,e)){i=!0;break}return!i}var r,o=t.$,a=[].slice,s=/\s+/;return r={on:function(t,e,i){var r,o=this;return e?(r=this._events||(this._events=[]),n(t,e,function(t,e){var n={e:t};n.cb=e,n.ctx=i,n.ctx2=i||o,n.id=r.length,r.push(n)}),this):this},once:function(t,e,i){var r=this;return e?(n(t,e,function(t,e){var n=function(){return r.off(t,n),e.apply(i||r,arguments)};n._cb=e,r.on(t,n,i)}),r):r},off:function(t,i,r){var a=this._events;return a?t||i||r?(n(t,i,function(t,n){o.each(e(a,t,n,r),function(){delete a[this.id]})}),this):(this._events=[],this):this},trigger:function(t){var n,r,o;return this._events&&t?(n=a.call(arguments,1),r=e(this._events,t),o=e(this._events,"all"),i(r,n)&&i(o,arguments)):this}},o.extend({installTo:function(t){return o.extend(t,r)}},r)}),e("uploader",["base","mediator"],function(t,e){function n(t){this.options=i.extend(!0,{},n.options,t),this._init(this.options)}var i=t.$;return n.options={},e.installTo(n.prototype),i.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(t,e){n.prototype[t]=function(){return this.request(e,arguments)}}),i.extend(n.prototype,{state:"pending",_init:function(t){var e=this;e.request("init",t,function(){e.state="ready",e.trigger("ready")})},option:function(t,e){var n=this.options;if(!(arguments.length>1))return t?n[t]:n;i.isPlainObject(e)&&i.isPlainObject(n[t])?i.extend(n[t],e):n[t]=e},getStats:function(){var t=this.request("get-stats");return t?{successNum:t.numOfSuccess,progressNum:t.numOfProgress,cancelNum:t.numOfCancel,invalidNum:t.numOfInvalid,uploadFailNum:t.numOfUploadFailed,queueNum:t.numOfQueue,interruptNum:t.numofInterrupt}:{}},trigger:function(t){var n=[].slice.call(arguments,1),r=this.options,o="on"+t.substring(0,1).toUpperCase()+t.substring(1);return!(!1===e.trigger.apply(this,arguments)||i.isFunction(r[o])&&!1===r[o].apply(this,n)||i.isFunction(this[o])&&!1===this[o].apply(this,n)||!1===e.trigger.apply(e,[this,t].concat(n)))},destroy:function(){this.request("destroy",arguments),this.off()},request:t.noop}),t.create=n.create=function(t){return new n(t)},t.Uploader=n,n}),e("runtime/runtime",["base","mediator"],function(t,e){function n(e){this.options=i.extend({container:document.body},e),this.uid=t.guid("rt_")}var i=t.$,r={},o=function(t){for(var e in t)if(t.hasOwnProperty(e))return e;return null};return i.extend(n.prototype,{getContainer:function(){var t,e,n=this.options;return this._container?this._container:(t=i(n.container||document.body),(e=i(document.createElement("div"))).attr("id","rt_"+this.uid),e.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),t.append(e),t.addClass("webuploader-container"),this._container=e,this._parent=t,e)},init:t.noop,exec:t.noop,destroy:function(){this._container&&this._container.remove(),this._parent&&this._parent.removeClass("webuploader-container"),this.off()}}),n.orders="html5,flash",n.addRuntime=function(t,e){r[t]=e},n.hasRuntime=function(t){return!!(t?r[t]:o(r))},n.create=function(t,e){var a;if(e=e||n.orders,i.each(e.split(/\s*,\s*/g),function(){if(r[this])return a=this,!1}),!(a=a||o(r)))throw new Error("Runtime Error");return new r[a](t)},e.installTo(n.prototype),n}),e("runtime/client",["base","mediator","runtime/runtime"],function(t,e,n){function i(e,i){var o,a=t.Deferred();this.uid=t.guid("client_"),this.runtimeReady=function(t){return a.done(t)},this.connectRuntime=function(e,s){if(o)throw new Error("already connected!");return a.done(s),"string"==typeof e&&r.get(e)&&(o=r.get(e)),(o=o||r.get(null,i))?(t.$.extend(o.options,e),o.__promise.then(a.resolve),o.__client++):((o=n.create(e,e.runtimeOrder)).__promise=a.promise(),o.once("ready",a.resolve),o.init(),r.add(o),o.__client=1),i&&(o.__standalone=i),o},this.getRuntime=function(){return o},this.disconnectRuntime=function(){o&&(o.__client--,o.__client<=0&&(r.remove(o),delete o.__promise,o.destroy()),o=null)},this.exec=function(){if(o){var n=t.slice(arguments);return e&&n.unshift(e),o.exec.apply(this,n)}},this.getRuid=function(){return o&&o.uid},this.destroy=function(t){return function(){t&&t.apply(this,arguments),this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()}}(this.destroy)}var r;return r=function(){var t={};return{add:function(e){t[e.uid]=e},get:function(e,n){var i;if(e)return t[e];for(i in t)if(!n||!t[i].__standalone)return t[i];return null},remove:function(e){delete t[e.uid]}}}(),e.installTo(i.prototype),i}),e("lib/dnd",["base","mediator","runtime/client"],function(t,e,n){function i(t){(t=this.options=r.extend({},i.options,t)).container=r(t.container),t.container.length&&n.call(this,"DragAndDrop")}var r=t.$;return i.options={accept:null,disableGlobalDnd:!1},t.inherits(n,{constructor:i,init:function(){var t=this;t.connectRuntime(t.options,function(){t.exec("init"),t.trigger("ready")})}}),e.installTo(i.prototype),i}),e("widgets/widget",["base","uploader"],function(t,e){function n(t){this.owner=t,this.options=t.options}var i=t.$,r=e.prototype._init,o=e.prototype.destroy,a={},s=[];return i.extend(n.prototype,{init:t.noop,invoke:function(t,e){var n=this.responseMap;return n&&t in n&&n[t]in this&&i.isFunction(this[n[t]])?this[n[t]].apply(this,e):a},request:function(){return this.owner.request.apply(this.owner,arguments)}}),i.extend(e.prototype,{_init:function(){var t=this,e=t._widgets=[],n=t.options.disableWidgets||"";return i.each(s,function(i,r){(!n||!~n.indexOf(r._name))&&e.push(new r(t))}),r.apply(t,arguments)},request:function(e,n,r){var o,s,c,u=0,l=this._widgets,d=l&&l.length,h=[],p=[];for(n=function(t){if(!t)return!1;var e=t.length,n=i.type(t);return!(1!==t.nodeType||!e)||"array"===n||"function"!==n&&"string"!==n&&(0===e||"number"==typeof e&&e>0&&e-1 in t)}(n)?n:[n];u<d;u++)(o=l[u].invoke(e,n))!==a&&(t.isPromise(o)?p.push(o):h.push(o));return r||p.length?(s=t.when.apply(t,p),c=s.pipe?"pipe":"then",s[c](function(){var e=t.Deferred(),n=arguments;return 1===n.length&&(n=n[0]),setTimeout(function(){e.resolve(n)},1),e.promise()})[r?c:"done"](r||t.noop)):h[0]},destroy:function(){o.apply(this,arguments),this._widgets=null}}),e.register=n.register=function(e,r){var o,a={init:"init",destroy:"destroy",name:"anonymous"};return 1===arguments.length?(r=e,i.each(r,function(t){"_"!==t[0]&&"name"!==t?a[t.replace(/[A-Z]/g,"-$&").toLowerCase()]=t:"name"===t&&(a.name=r.name)})):a=i.extend(a,e),r.responseMap=a,o=t.inherits(n,r),o._name=a.name,s.push(o),o},e.unRegister=n.unRegister=function(t){if(t&&"anonymous"!==t)for(var e=s.length;e--;)s[e]._name===t&&s.splice(e,1)},n}),e("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(t,e,n){var i=t.$;return e.options.dnd="",e.register({name:"dnd",init:function(e){if(e.dnd&&"html5"===this.request("predict-runtime-type")){var r,o=this,a=t.Deferred(),s=i.extend({},{disableGlobalDnd:e.disableGlobalDnd,container:e.dnd,accept:e.accept});return this.dnd=r=new n(s),r.once("ready",a.resolve),r.on("drop",function(t){o.request("add-file",[t])}),r.on("accept",function(t){return o.owner.trigger("dndAccept",t)}),r.init(),a.promise()}},destroy:function(){this.dnd&&this.dnd.destroy()}})}),e("lib/filepaste",["base","mediator","runtime/client"],function(t,e,n){function i(t){(t=this.options=r.extend({},t)).container=r(t.container||document.body),n.call(this,"FilePaste")}var r=t.$;return t.inherits(n,{constructor:i,init:function(){var t=this;t.connectRuntime(t.options,function(){t.exec("init"),t.trigger("ready")})}}),e.installTo(i.prototype),i}),e("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(t,e,n){var i=t.$;return e.register({name:"paste",init:function(e){if(e.paste&&"html5"===this.request("predict-runtime-type")){var r,o=this,a=t.Deferred(),s=i.extend({},{container:e.paste,accept:e.accept});return this.paste=r=new n(s),r.once("ready",a.resolve),r.on("paste",function(t){o.owner.request("add-file",[t])}),r.init(),a.promise()}},destroy:function(){this.paste&&this.paste.destroy()}})}),e("lib/blob",["base","runtime/client"],function(t,e){function n(t,n){this.source=n,this.ruid=t,this.size=n.size||0,!n.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)?this.type="image/"+("jpg"===this.ext?"jpeg":this.ext):this.type=n.type||"application/octet-stream",e.call(this,"Blob"),this.uid=n.uid||this.uid,t&&this.connectRuntime(t)}return t.inherits(e,{constructor:n,slice:function(t,e){return this.exec("slice",t,e)},getSource:function(){return this.source}}),n}),e("lib/file",["base","lib/blob"],function(t,e){var n=1,i=/\.([^.]+)$/;return t.inherits(e,function(t,r){var o;this.name=r.name||"untitled"+n++,!(o=i.exec(r.name)?RegExp.$1.toLowerCase():"")&&r.type&&(o=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(r.type)?RegExp.$1.toLowerCase():"",this.name+="."+o),this.ext=o,this.lastModifiedDate=r.lastModifiedDate||(new Date).toLocaleString(),e.apply(this,arguments)})}),e("lib/filepicker",["base","runtime/client","lib/file"],function(e,n,i){function r(t){if(t=this.options=o.extend({},r.options,t),t.container=o(t.id),!t.container.length)throw new Error("按钮指定错误");t.innerHTML=t.innerHTML||t.label||t.container.html()||"",t.button=o(t.button||document.createElement("div")),t.button.html(t.innerHTML),t.container.html(t.button),n.call(this,"FilePicker",!0)}var o=e.$;return r.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file",style:"webuploader-pick"},e.inherits(n,{constructor:r,init:function(){var n=this,r=n.options,a=r.button,s=r.style;s&&a.addClass("webuploader-pick"),n.on("all",function(t){var e;switch(t){case"mouseenter":s&&a.addClass("webuploader-pick-hover");break;case"mouseleave":s&&a.removeClass("webuploader-pick-hover");break;case"change":e=n.exec("getFiles"),n.trigger("select",o.map(e,function(t){return t=new i(n.getRuid(),t),t._refer=r.container,t}),r.container)}}),n.connectRuntime(r,function(){n.refresh(),n.exec("init",r),n.trigger("ready")}),this._resizeHandler=e.bindFn(this.refresh,this),o(t).on("resize",this._resizeHandler)},refresh:function(){var t=this.getRuntime().getContainer(),e=this.options.button,n=e.outerWidth?e.outerWidth():e.width(),i=e.outerHeight?e.outerHeight():e.height(),r=e.offset();n&&i&&t.css({bottom:"auto",right:"auto",width:n+"px",height:i+"px"}).offset(r)},enable:function(){this.options.button.removeClass("webuploader-pick-disable"),this.refresh()},disable:function(){var t=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"}),t.addClass("webuploader-pick-disable")},destroy:function(){var e=this.options.button;o(t).off("resize",this._resizeHandler),e.removeClass("webuploader-pick-disable webuploader-pick-hover webuploader-pick")}}),r}),e("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(t,e,n){var i=t.$;return i.extend(e.options,{pick:null,accept:null}),e.register({name:"picker",init:function(t){return this.pickers=[],t.pick&&this.addBtn(t.pick)},refresh:function(){i.each(this.pickers,function(){this.refresh()})},addBtn:function(e){var r=this,o=r.options,a=o.accept,s=[];if(e)return i.isPlainObject(e)||(e={id:e}),i(e.id).each(function(){var c,u,l;l=t.Deferred(),c=i.extend({},e,{accept:i.isPlainObject(a)?[a]:a,swf:o.swf,runtimeOrder:o.runtimeOrder,id:this}),(u=new n(c)).once("ready",l.resolve),u.on("select",function(t){r.owner.request("add-file",[t])}),u.on("dialogopen",function(){r.owner.trigger("dialogOpen",u.button)}),u.init(),r.pickers.push(u),s.push(l.promise())}),t.when.apply(t,s)},disable:function(){i.each(this.pickers,function(){this.disable()})},enable:function(){i.each(this.pickers,function(){this.enable()})},destroy:function(){i.each(this.pickers,function(){this.destroy()}),this.pickers=null}})}),e("lib/image",["base","runtime/client","lib/blob"],function(t,e,n){function i(t){this.options=r.extend({},i.options,t),e.call(this,"Image"),this.on("load",function(){this._info=this.exec("info"),this._meta=this.exec("meta")})}var r=t.$;return i.options={quality:90,crop:!1,preserveHeaders:!1,allowMagnify:!1},t.inherits(e,{constructor:i,info:function(t){return t?(this._info=t,this):this._info},meta:function(t){return t?(this._meta=t,this):this._meta},loadFromBlob:function(t){var e=this,n=t.getRuid();this.connectRuntime(n,function(){e.exec("init",e.options),e.exec("loadFromBlob",t)})},resize:function(){var e=t.slice(arguments);return this.exec.apply(this,["resize"].concat(e))},crop:function(){var e=t.slice(arguments);return this.exec.apply(this,["crop"].concat(e))},getAsDataUrl:function(t){return this.exec("getAsDataUrl",t)},getAsBlob:function(t){var e=this.exec("getAsBlob",t);return new n(this.getRuid(),e)}}),i}),e("widgets/image",["base","uploader","lib/image","widgets/widget"],function(t,e,n){var i,r=t.$;return i=function(t){var e=0,n=[],i=function(){for(var t;n.length&&e<5242880;)t=n.shift(),e+=t[0],t[1]()};return function(t,r,o){n.push([r,o]),t.once("destroy",function(){e-=r,setTimeout(i,1)}),setTimeout(i,1)}}(),r.extend(e.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}}),e.register({name:"image",makeThumb:function(t,e,o,a){var s,c;(t=this.request("get-file",t)).type.match(/^image/)?(s=r.extend({},this.options.thumb),r.isPlainObject(o)&&(s=r.extend(s,o),o=null),o=o||s.width,a=a||s.height,(c=new n(s)).once("load",function(){t._info=t._info||c.info(),t._meta=t._meta||c.meta(),o<=1&&o>0&&(o=t._info.width*o),a<=1&&a>0&&(a=t._info.height*a),c.resize(o,a)}),c.once("complete",function(){e(!1,c.getAsDataUrl(s.type)),c.destroy()}),c.once("error",function(t){e(t||!0),c.destroy()}),i(c,t.source.size,function(){t._info&&c.info(t._info),t._meta&&c.meta(t._meta),c.loadFromBlob(t.source)})):e(!0)},beforeSendFile:function(e){var i,o,a=this.options.compress||this.options.resize,s=a&&a.compressSize||0,c=a&&a.noCompressIfLarger||!1;if(e=this.request("get-file",e),a&&~"image/jpeg,image/jpg".indexOf(e.type)&&!(e.size<s)&&!e._compressed)return a=r.extend({},a),o=t.Deferred(),i=new n(a),o.always(function(){i.destroy(),i=null}),i.once("error",o.reject),i.once("load",function(){var t=a.width,n=a.height;e._info=e._info||i.info(),e._meta=e._meta||i.meta(),t<=1&&t>0&&(t=e._info.width*t),n<=1&&n>0&&(n=e._info.height*n),i.resize(t,n)}),i.once("complete",function(){var t,n;try{t=i.getAsBlob(a.type),n=e.size,(!c||t.size<n)&&(e.source=t,e.size=t.size,e.trigger("resize",t.size,n)),e._compressed=!0,o.resolve()}catch(t){o.resolve()}}),e._info&&i.info(e._info),e._meta&&i.meta(e._meta),i.loadFromBlob(e.source),o.promise()}})}),e("file",["base","mediator"],function(t,e){function n(t){this.name=t.name||"Untitled",this.size=t.size||0,this.type=t.type||"application/octet-stream",this.lastModifiedDate=t.lastModifiedDate||1*new Date,this.id=i+r++,this.ext=o.exec(this.name)?RegExp.$1:"",this.statusText="",a[this.id]=n.Status.INITED,this.source=t,this.loaded=0,this.on("error",function(t){this.setStatus(n.Status.ERROR,t)})}var i="WU_FILE_",r=0,o=/\.([^.]+)$/,a={};return t.$.extend(n.prototype,{setStatus:function(t,e){var n=a[this.id];void 0!==e&&(this.statusText=e),t!==n&&(a[this.id]=t,this.trigger("statuschange",t,n))},getStatus:function(){return a[this.id]},getSource:function(){return this.source},destroy:function(){this.off(),delete a[this.id]}}),e.installTo(n.prototype),n.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},n}),e("queue",["base","mediator","file"],function(t,e,n){function i(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0},this._queue=[],this._map={}}var r=t.$,o=n.Status;return r.extend(i.prototype,{append:function(t){return this._queue.push(t),this._fileAdded(t),this},prepend:function(t){return this._queue.unshift(t),this._fileAdded(t),this},getFile:function(t){return"string"!=typeof t?t:this._map[t]},fetch:function(t){var e,n,i=this._queue.length;for(t=t||o.QUEUED,e=0;e<i;e++)if(n=this._queue[e],t===n.getStatus())return n;return null},sort:function(t){"function"==typeof t&&this._queue.sort(t)},getFiles:function(){for(var t,e=[].slice.call(arguments,0),n=[],i=0,o=this._queue.length;i<o;i++)t=this._queue[i],e.length&&!~r.inArray(t.getStatus(),e)||n.push(t);return n},removeFile:function(t){this._map[t.id]&&(delete this._map[t.id],t.destroy(),this.stats.numofDeleted++)},_fileAdded:function(t){var e=this;this._map[t.id]||(this._map[t.id]=t,t.on("statuschange",function(t,n){e._onFileStatusChange(t,n)}))},_onFileStatusChange:function(t,e){var n=this.stats;switch(e){case o.PROGRESS:n.numOfProgress--;break;case o.QUEUED:n.numOfQueue--;break;case o.ERROR:n.numOfUploadFailed--;break;case o.INVALID:n.numOfInvalid--;break;case o.INTERRUPT:n.numofInterrupt--}switch(t){case o.QUEUED:n.numOfQueue++;break;case o.PROGRESS:n.numOfProgress++;break;case o.ERROR:n.numOfUploadFailed++;break;case o.COMPLETE:n.numOfSuccess++;break;case o.CANCELLED:n.numOfCancel++;break;case o.INVALID:n.numOfInvalid++;break;case o.INTERRUPT:n.numofInterrupt++}}}),e.installTo(i.prototype),i}),e("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(t,e,n,i,r,o){var a=t.$,s=/\.\w+$/,c=i.Status;return e.register({name:"queue",init:function(e){var i,r,s,c,u,l,d,h=this;if(a.isPlainObject(e.accept)&&(e.accept=[e.accept]),e.accept){for(u=[],s=0,r=e.accept.length;s<r;s++)(c=e.accept[s].extensions)&&u.push(c);u.length&&(l="\\."+u.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"),h.accept=new RegExp(l,"i")}if(h.queue=new n,h.stats=h.queue.stats,"html5"===this.request("predict-runtime-type"))return i=t.Deferred(),this.placeholder=d=new o("Placeholder"),d.connectRuntime({runtimeOrder:"html5"},function(){h._ruid=d.getRuid(),i.resolve()}),i.promise()},_wrapFile:function(t){if(!(t instanceof i)){if(!(t instanceof r)){if(!this._ruid)throw new Error("Can't add external files.");t=new r(this._ruid,t)}t=new i(t)}return t},acceptFile:function(t){return!(!t||!t.size||this.accept&&s.exec(t.name)&&!this.accept.test(t.name))},_addFile:function(t){var e=this;if(t=e._wrapFile(t),e.owner.trigger("beforeFileQueued",t)){if(e.acceptFile(t))return e.queue.append(t),e.owner.trigger("fileQueued",t),t;e.owner.trigger("error","Q_TYPE_DENIED",t)}},getFile:function(t){return this.queue.getFile(t)},addFile:function(t){var e=this;t.length||(t=[t]),(t=a.map(t,function(t){return e._addFile(t)})).length&&(e.owner.trigger("filesQueued",t),e.options.auto&&setTimeout(function(){e.request("start-upload")},20))},getStats:function(){return this.stats},removeFile:function(t,e){t=t.id?t:this.queue.getFile(t),this.request("cancel-file",t),e&&this.queue.removeFile(t)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(t,e){var n,i,r;if(t)return(t=t.id?t:this.queue.getFile(t)).setStatus(c.QUEUED),void(e||this.request("start-upload"));for(i=0,r=(n=this.queue.getFiles(c.ERROR)).length;i<r;i++)(t=n[i]).setStatus(c.QUEUED);this.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset"),this.queue=new n,this.stats=this.queue.stats},destroy:function(){this.reset(),this.placeholder&&this.placeholder.destroy()}})}),e("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(t,e){return t.support=function(){return e.hasRuntime.apply(e,arguments)},t.register({name:"runtime",init:function(){if(!this.predictRuntimeType())throw Error("Runtime Error")},predictRuntimeType:function(){var t,n,i=this.options.runtimeOrder||e.orders,r=this.type;if(!r)for(t=0,n=(i=i.split(/\s*,\s*/g)).length;t<n;t++)if(e.hasRuntime(i[t])){this.type=r=i[t];break}return r}})}),e("lib/transport",["base","runtime/client","mediator"],function(t,e,n){function i(t){var n=this;t=n.options=r.extend(!0,{},i.options,t||{}),e.call(this,"Transport"),this._blob=null,this._formData=t.formData||{},this._headers=t.headers||{},this.on("progress",this._timeout),this.on("load error",function(){n.trigger("progress",1),clearTimeout(n._timer)})}var r=t.$;return i.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12e4,formData:{},headers:{},sendAsBinary:!1},r.extend(i.prototype,{appendBlob:function(t,e,n){var i=this,r=i.options;i.getRuid()&&i.disconnectRuntime(),i.connectRuntime(e.ruid,function(){i.exec("init")}),i._blob=e,r.fileVal=t||r.fileVal,r.filename=n||r.filename},append:function(t,e){"object"==typeof t?r.extend(this._formData,t):this._formData[t]=e},setRequestHeader:function(t,e){"object"==typeof t?r.extend(this._headers,t):this._headers[t]=e},send:function(t){this.exec("send",t),this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy"),this.off(),this.exec("destroy"),this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var t=this,e=t.options.timeout;e&&(clearTimeout(t._timer),t._timer=setTimeout(function(){t.abort(),t.trigger("error","timeout")},e))}}),n.installTo(i.prototype),i}),e("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(t,e,n,i){var r=t.$,o=t.isPromise,a=n.Status;r.extend(e.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:{}}),e.register({name:"upload",init:function(){var e=this.owner,n=this;this.runing=!1,this.progress=!1,e.on("startUpload",function(){n.progress=!0}).on("uploadFinished",function(){n.progress=!1}),this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this.__tick=t.bindFn(this._tick,this),e.on("uploadComplete",function(t){t.blocks&&r.each(t.blocks,function(t,e){e.transport&&(e.transport.abort(),e.transport.destroy()),delete e.transport}),delete t.blocks,delete t.remaning})},reset:function(){this.request("stop-upload",!0),this.runing=!1,this.pool=[],this.stack=[],this.pending=[],this.remaning=0,this._trigged=!1,this._promise=null},startUpload:function(e){var n=this;if(r.each(n.request("get-files",a.INVALID),function(){n.request("remove-file",this)}),e?(e=e.id?e:n.request("get-file",e)).getStatus()===a.INTERRUPT?(e.setStatus(a.QUEUED),r.each(n.pool,function(t,n){n.file===e&&(n.transport&&n.transport.send(),e.setStatus(a.PROGRESS))})):e.getStatus()!==a.PROGRESS&&e.setStatus(a.QUEUED):r.each(n.request("get-files",[a.INITED]),function(){this.setStatus(a.QUEUED)}),n.runing)return t.nextTick(n.__tick);n.runing=!0;var i=[];e||r.each(n.pool,function(t,e){var r=e.file;r.getStatus()===a.INTERRUPT&&(n._trigged=!1,i.push(r),e.transport&&e.transport.send())}),r.each(i,function(){this.setStatus(a.PROGRESS)}),e||r.each(n.request("get-files",a.INTERRUPT),function(){this.setStatus(a.PROGRESS)}),n._trigged=!1,t.nextTick(n.__tick),n.owner.trigger("startUpload")},stopUpload:function(e,n){var i,o=this;if(!0===e&&(n=e,e=null),!1!==o.runing){if(e){if((e=e.id?e:o.request("get-file",e)).getStatus()!==a.PROGRESS&&e.getStatus()!==a.QUEUED)return;return e.setStatus(a.INTERRUPT),r.each(o.pool,function(t,n){if(n.file===e)return i=n,!1}),i.transport&&i.transport.abort(),n&&(o._putback(i),o._popBlock(i)),t.nextTick(o.__tick)}o.runing=!1,this._promise&&this._promise.file&&this._promise.file.setStatus(a.INTERRUPT),n&&r.each(o.pool,function(t,e){e.transport&&e.transport.abort(),e.file.setStatus(a.INTERRUPT)}),o.owner.trigger("stopUpload")}},cancelFile:function(t){(t=t.id?t:this.request("get-file",t)).blocks&&r.each(t.blocks,function(t,e){var n=e.transport;n&&(n.abort(),n.destroy(),delete e.transport)}),t.setStatus(a.CANCELLED),this.owner.trigger("fileDequeued",t)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(t,e){(t=t.id?t:this.request("get-file",t)).setStatus(e||a.COMPLETE),t.skipped=!0,t.blocks&&r.each(t.blocks,function(t,e){var n=e.transport;n&&(n.abort(),n.destroy(),delete e.transport)}),this.owner.trigger("uploadSkip",t)},_tick:function(){var e,n,i=this,r=i.options;if(i._promise)return i._promise.always(i.__tick);i.pool.length<r.threads&&(n=i._nextBlock())?(i._trigged=!1,e=function(e){i._promise=null,e&&e.file&&i._startSend(e),t.nextTick(i.__tick)},i._promise=o(n)?n.always(e):e(n)):i.remaning||i._getStats().numOfQueue||i._getStats().numofInterrupt||(i.runing=!1,i._trigged||t.nextTick(function(){i.owner.trigger("uploadFinished")}),i._trigged=!0)},_putback:function(t){t.cuted.unshift(t),~this.stack.indexOf(t.cuted)||this.stack.unshift(t.cuted)},_getStack:function(){for(var t,e=0;t=this.stack[e++];){if(t.has()&&t.file.getStatus()===a.PROGRESS)return t;(!t.has()||t.file.getStatus()!==a.PROGRESS&&t.file.getStatus()!==a.INTERRUPT)&&this.stack.splice(--e,1)}return null},_nextBlock:function(){var t,e,n,i,r=this,a=r.options;return(t=this._getStack())?(a.prepareNextFile&&!r.pending.length&&r._prepareNextFile(),t.shift()):r.runing?(!r.pending.length&&r._getStats().numOfQueue&&r._prepareNextFile(),e=r.pending.shift(),n=function(e){return e?(t=function(t,e){var n,i,r=[],o=t.source.size,a=e?Math.ceil(o/e):1,s=0,c=0;for(i={file:t,has:function(){return!!r.length},shift:function(){return r.shift()},unshift:function(t){r.unshift(t)}};c<a;)n=Math.min(e,o-s),r.push({file:t,start:s,end:e?s+n:o,total:o,chunks:a,chunk:c++,cuted:i}),s+=n;return t.blocks=r.concat(),t.remaning=r.length,i}(e,a.chunked?a.chunkSize:0),r.stack.push(t),t.shift()):null},o(e)?(i=e.file,e=e[e.pipe?"pipe":"then"](n),e.file=i,e):n(e)):void 0},_prepareNextFile:function(){var t,e=this,n=e.request("fetch-file"),i=e.pending;n&&(t=e.request("before-send-file",n,function(){return n.getStatus()===a.PROGRESS||n.getStatus()===a.INTERRUPT?n:e._finishFile(n)}),e.owner.trigger("uploadStart",n),n.setStatus(a.PROGRESS),t.file=n,t.done(function(){var e=r.inArray(t,i);~e&&i.splice(e,1,n)}),t.fail(function(t){n.setStatus(a.ERROR,t),e.owner.trigger("uploadError",n,t),e.owner.trigger("uploadComplete",n)}),i.push(t))},_popBlock:function(t){var e=r.inArray(t,this.pool);this.pool.splice(e,1),t.file.remaning--,this.remaning--},_startSend:function(e){var n=this,i=e.file;i.getStatus()===a.PROGRESS?(n.pool.push(e),n.remaning++,e.blob=1===e.chunks?i.source:i.source.slice(e.start,e.end),n.request("before-send",e,function(){i.getStatus()===a.PROGRESS?n._doSend(e):(n._popBlock(e),t.nextTick(n.__tick))}).fail(function(){1===i.remaning?n._finishFile(i).always(function(){e.percentage=1,n._popBlock(e),n.owner.trigger("uploadComplete",i),t.nextTick(n.__tick)}):(e.percentage=1,n.updateFileProgress(i),n._popBlock(e),t.nextTick(n.__tick))})):i.getStatus()===a.INTERRUPT&&n._putback(e)},_doSend:function(e){var n,o,s=this,c=s.owner,u=s.options,l=e.file,d=new i(u),h=r.extend({},u.formData),p=r.extend({},u.headers);e.transport=d,d.on("destroy",function(){delete e.transport,s._popBlock(e),t.nextTick(s.__tick)}),d.on("progress",function(t){e.percentage=t,s.updateFileProgress(l)}),n=function(t){var n;return o=d.getResponseAsJson()||{},o._raw=d.getResponse(),n=function(e){t=e},c.trigger("uploadAccept",e,o,n)||(t=t||"server"),t},d.on("error",function(t,i){e.retried=e.retried||0,e.chunks>1&&~"http,abort".indexOf(t)&&e.retried<u.chunkRetry?(e.retried++,d.send()):(i||"server"!==t||(t=n(t)),l.setStatus(a.ERROR,t),c.trigger("uploadError",l,t),c.trigger("uploadComplete",l))}),d.on("load",function(){var t;(t=n())?d.trigger("error",t,!0):1===l.remaning?s._finishFile(l,o):d.destroy()}),h=r.extend(h,{id:l.id,name:l.name,type:l.type,lastModifiedDate:l.lastModifiedDate,size:l.size}),e.chunks>1&&r.extend(h,{chunks:e.chunks,chunk:e.chunk}),c.trigger("uploadBeforeSend",e,h,p),d.appendBlob(u.fileVal,e.blob,l.name),d.append(h),d.setRequestHeader(p),d.send()},_finishFile:function(t,e,n){var i=this.owner;return i.request("after-send-file",arguments,function(){t.setStatus(a.COMPLETE),i.trigger("uploadSuccess",t,e,n)}).fail(function(e){t.getStatus()===a.PROGRESS&&t.setStatus(a.ERROR,e),i.trigger("uploadError",t,e)}).always(function(){i.trigger("uploadComplete",t)})},updateFileProgress:function(t){var e=0,n=0;t.blocks&&(r.each(t.blocks,function(t,e){n+=(e.percentage||0)*(e.end-e.start)}),e=n/t.size,this.owner.trigger("uploadProgress",t,e||0))}})}),e("widgets/validator",["base","uploader","file","widgets/widget"],function(t,e,n){var i,r=t.$,o={};return i={addValidator:function(t,e){o[t]=e},removeValidator:function(t){delete o[t]}},e.register({name:"validator",init:function(){var e=this;t.nextTick(function(){r.each(o,function(){this.call(e.owner)})})}}),i.addValidator("fileNumLimit",function(){var t=this.options,e=0,n=parseInt(t.fileNumLimit,10),i=!0;n&&(this.on("beforeFileQueued",function(t){return e>=n&&i&&(i=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",n,t),setTimeout(function(){i=!0},1)),!(e>=n)}),this.on("fileQueued",function(){e++}),this.on("fileDequeued",function(){e--}),this.on("reset",function(){e=0}))}),i.addValidator("fileSizeLimit",function(){var t=this.options,e=0,n=parseInt(t.fileSizeLimit,10),i=!0;n&&(this.on("beforeFileQueued",function(t){var r=e+t.size>n;return r&&i&&(i=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",n,t),setTimeout(function(){i=!0},1)),!r}),this.on("fileQueued",function(t){e+=t.size}),this.on("fileDequeued",function(t){e-=t.size}),this.on("reset",function(){e=0}))}),i.addValidator("fileSingleSizeLimit",function(){var t=this.options.fileSingleSizeLimit;t&&this.on("beforeFileQueued",function(e){if(e.size>t)return e.setStatus(n.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",t,e),!1})}),i.addValidator("duplicate",function(){var t={};this.options.duplicate||(this.on("beforeFileQueued",function(e){var n=e.__hash||(e.__hash=function(t){for(var e=0,n=0,i=t.length;n<i;n++)e=t.charCodeAt(n)+(e<<6)+(e<<16)-e;return e}(e.name+e.size+e.lastModifiedDate));if(t[n])return this.trigger("error","F_DUPLICATE",e),!1}),this.on("fileQueued",function(e){var n=e.__hash;n&&(t[n]=!0)}),this.on("fileDequeued",function(e){var n=e.__hash;n&&delete t[n]}),this.on("reset",function(){t={}}))}),i}),e("runtime/compbase",[],function(){return function(t,e){this.owner=t,this.options=t.options,this.getRuntime=function(){return e},this.getRuid=function(){return e.uid},this.trigger=function(){return t.trigger.apply(t,arguments)}}}),e("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(e,n,i){function r(){var t={},i=this,r=this.destroy;n.apply(i,arguments),i.type=o,i.exec=function(n,r){var o,s=this.uid,c=e.slice(arguments,2);if(a[n]&&(o=t[s]=t[s]||new a[n](this,i))[r])return o[r].apply(o,c)},i.destroy=function(){return r&&r.apply(this,arguments)}}var o="html5",a={};return e.inherits(n,{constructor:r,init:function(){var t=this;setTimeout(function(){t.trigger("ready")},1)}}),r.register=function(t,n){return a[t]=e.inherits(i,n)},t.Blob&&t.FileReader&&t.DataView&&n.addRuntime(o,r),r}),e("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(t,e){return t.register("Blob",{slice:function(t,n){var i=this.owner.source;return i=(i.slice||i.webkitSlice||i.mozSlice).call(i,t,n),new e(this.getRuid(),i)}})}),e("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(t,e,n){var i=t.$,r="webuploader-dnd-";return e.register("DragAndDrop",{init:function(){var e=this.elem=this.options.container;this.dragEnterHandler=t.bindFn(this._dragEnterHandler,this),this.dragOverHandler=t.bindFn(this._dragOverHandler,this),this.dragLeaveHandler=t.bindFn(this._dragLeaveHandler,this),this.dropHandler=t.bindFn(this._dropHandler,this),this.dndOver=!1,e.on("dragenter",this.dragEnterHandler),e.on("dragover",this.dragOverHandler),e.on("dragleave",this.dragLeaveHandler),e.on("drop",this.dropHandler),this.options.disableGlobalDnd&&(i(document).on("dragover",this.dragOverHandler),i(document).on("drop",this.dropHandler))},_dragEnterHandler:function(t){var e,n=this,i=n._denied||!1;return t=t.originalEvent||t,n.dndOver||(n.dndOver=!0,(e=t.dataTransfer.items)&&e.length&&(n._denied=i=!n.trigger("accept",e)),n.elem.addClass(r+"over"),n.elem[i?"addClass":"removeClass"](r+"denied")),t.dataTransfer.dropEffect=i?"none":"copy",!1},_dragOverHandler:function(t){var e=this.elem.parent().get(0);return!(e&&!i.contains(e,t.currentTarget)||(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,t),1))},_dragLeaveHandler:function(){var t,e=this;return t=function(){e.dndOver=!1,e.elem.removeClass(r+"over "+r+"denied")},clearTimeout(e._leaveTimer),e._leaveTimer=setTimeout(t,100),!1},_dropHandler:function(t){var e,o,a=this,s=a.getRuid(),c=a.elem.parent().get(0);if(c&&!i.contains(c,t.currentTarget))return!1;e=(t=t.originalEvent||t).dataTransfer;try{o=e.getData("text/html")}catch(t){}return a.dndOver=!1,a.elem.removeClass(r+"over"),o?void 0:(a._getTansferFiles(e,function(t){a.trigger("drop",i.map(t,function(t){return new n(s,t)}))}),!1)},_getTansferFiles:function(e,n){var i,r,o,a,s,c,u,l=[],d=[];for(i=e.items,r=e.files,u=!(!i||!i[0].webkitGetAsEntry),s=0,c=r.length;s<c;s++)o=r[s],a=i&&i[s],u&&a.webkitGetAsEntry().isDirectory?d.push(this._traverseDirectoryTree(a.webkitGetAsEntry(),l)):l.push(o);t.when.apply(t,d).done(function(){l.length&&n(l)})},_traverseDirectoryTree:function(e,n){var i=t.Deferred(),r=this;return e.isFile?e.file(function(t){n.push(t),i.resolve()}):e.isDirectory&&e.createReader().readEntries(function(e){var o,a=e.length,s=[],c=[];for(o=0;o<a;o++)s.push(r._traverseDirectoryTree(e[o],c));t.when.apply(t,s).then(function(){n.push.apply(n,c),i.resolve()},i.reject)}),i.promise()},destroy:function(){var t=this.elem;t&&(t.off("dragenter",this.dragEnterHandler),t.off("dragover",this.dragOverHandler),t.off("dragleave",this.dragLeaveHandler),t.off("drop",this.dropHandler),this.options.disableGlobalDnd&&(i(document).off("dragover",this.dragOverHandler),i(document).off("drop",this.dropHandler)))}})}),e("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(t,e,n){return e.register("FilePaste",{init:function(){var e,n,i,r,o=this.options,a=this.elem=o.container,s=".*";if(o.accept){for(e=[],n=0,i=o.accept.length;n<i;n++)(r=o.accept[n].mimeTypes)&&e.push(r);e.length&&(s=(s=e.join(",")).replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=s=new RegExp(s,"i"),this.hander=t.bindFn(this._pasteHander,this),a.on("paste",this.hander)},_pasteHander:function(t){var e,i,r,o,a,s=[],c=this.getRuid();for(o=0,a=(e=(t=t.originalEvent||t).clipboardData.items).length;o<a;o++)"file"===(i=e[o]).kind&&(r=i.getAsFile())&&s.push(new n(c,r));s.length&&(t.preventDefault(),t.stopPropagation(),this.trigger("paste",s))},destroy:function(){this.elem.off("paste",this.hander)}})}),e("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(t,e){var n=t.$;return e.register("FilePicker",{init:function(){var t,e,i,r,o=this.getRuntime().getContainer(),a=this,s=a.owner,c=a.options,u=this.label=n(document.createElement("label")),l=this.input=n(document.createElement("input"));if(l.attr("type","file"),l.attr("capture","camera"),l.attr("name",c.name),l.addClass("webuploader-element-invisible"),u.on("click",function(t){l.trigger("click"),t.stopPropagation(),s.trigger("dialogopen")}),u.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),c.multiple&&l.attr("multiple","multiple"),c.accept&&c.accept.length>0){for(t=[],e=0,i=c.accept.length;e<i;e++)t.push(c.accept[e].mimeTypes);l.attr("accept",t.join(","))}o.append(l),o.append(u),r=function(t){s.trigger(t.type)},l.on("change",function(t){var e,i=arguments.callee;a.files=t.target.files,(e=this.cloneNode(!0)).value=null,this.parentNode.replaceChild(e,this),l.off(),l=n(e).on("change",i).on("mouseenter mouseleave",r),s.trigger("change")}),u.on("mouseenter mouseleave",r)},getFiles:function(){return this.files},destroy:function(){this.input.off(),this.label.off()}})}),e("runtime/html5/util",["base"],function(e){var n=t.createObjectURL&&t||t.URL&&URL.revokeObjectURL&&URL||t.webkitURL,i=e.noop,r=i;return n&&(i=function(){return n.createObjectURL.apply(n,arguments)},r=function(){return n.revokeObjectURL.apply(n,arguments)}),{createObjectURL:i,revokeObjectURL:r,dataURL2Blob:function(t){var e,n,i,r,o,a;for(e=~(a=t.split(","))[0].indexOf("base64")?atob(a[1]):decodeURIComponent(a[1]),i=new ArrayBuffer(e.length),n=new Uint8Array(i),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return o=a[0].split(":")[1].split(";")[0],this.arrayBufferToBlob(i,o)},dataURL2ArrayBuffer:function(t){var e,n,i,r;for(e=~(r=t.split(","))[0].indexOf("base64")?atob(r[1]):decodeURIComponent(r[1]),n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n.buffer},arrayBufferToBlob:function(e,n){var i,r=t.BlobBuilder||t.WebKitBlobBuilder;return r?((i=new r).append(e),i.getBlob(n)):new Blob([e],n?{type:n}:{})},canvasToDataUrl:function(t,e,n){return t.toDataURL(e,n/100)},parseMeta:function(t,e){e(!1,{})},updateImageHead:function(t){return t}}}),e("runtime/html5/imagemeta",["runtime/html5/util"],function(t){var e;return e={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(t,e){var n=this,i=new FileReader;i.onload=function(){e(!1,n._parse(this.result)),i=i.onload=i.onerror=null},i.onerror=function(t){e(t.message),i=i.onload=i.onerror=null},t=t.slice(0,n.maxMetaDataSize),i.readAsArrayBuffer(t.getSource())},_parse:function(t,n){if(!(t.byteLength<6)){var i,r,o,a,s=new DataView(t),c=2,u=s.byteLength-4,l=c,d={};if(65496===s.getUint16(0)){for(;c<u&&((i=s.getUint16(c))>=65504&&i<=65519||65534===i)&&(r=s.getUint16(c+2)+2,!(c+r>s.byteLength));){if(o=e.parsers[i],!n&&o)for(a=0;a<o.length;a+=1)o[a].call(e,s,c,r,d);l=c+=r}l>6&&(t.slice?d.imageHead=t.slice(2,l):d.imageHead=new Uint8Array(t).subarray(2,l))}return d}},updateImageHead:function(t,e){var n,i,r,o=this._parse(t,!0);return r=2,o.imageHead&&(r=2+o.imageHead.byteLength),i=t.slice?t.slice(r):new Uint8Array(t).subarray(r),n=new Uint8Array(e.byteLength+2+i.byteLength),n[0]=255,n[1]=216,n.set(new Uint8Array(e),2),n.set(new Uint8Array(i),e.byteLength+2),n.buffer}},t.parseMeta=function(){return e.parse.apply(e,arguments)},t.updateImageHead=function(){return e.updateImageHead.apply(e,arguments)},e}),e("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(t,e){var n={};return n.ExifMap=function(){return this},n.ExifMap.prototype.map={Orientation:274},n.ExifMap.prototype.get=function(t){return this[t]||this[this.map[t]]},n.exifTagTypes={1:{getValue:function(t,e){return t.getUint8(e)},size:1},2:{getValue:function(t,e){return String.fromCharCode(t.getUint8(e))},size:1,ascii:!0},3:{getValue:function(t,e,n){return t.getUint16(e,n)},size:2},4:{getValue:function(t,e,n){return t.getUint32(e,n)},size:4},5:{getValue:function(t,e,n){return t.getUint32(e,n)/t.getUint32(e+4,n)},size:8},9:{getValue:function(t,e,n){return t.getInt32(e,n)},size:4},10:{getValue:function(t,e,n){return t.getInt32(e,n)/t.getInt32(e+4,n)},size:8}},n.exifTagTypes[7]=n.exifTagTypes[1],n.getExifValue=function(e,i,r,o,a,s){var c,u,l,d,h,p,f=n.exifTagTypes[o];if(f){if(c=f.size*a,!((u=c>4?i+e.getUint32(r+8,s):r+8)+c>e.byteLength)){if(1===a)return f.getValue(e,u,s);for(l=[],d=0;d<a;d+=1)l[d]=f.getValue(e,u+d*f.size,s);if(f.ascii){for(h="",d=0;d<l.length&&"\0"!==(p=l[d]);d+=1)h+=p;return h}return l}t.log("Invalid Exif data: Invalid data offset.")}else t.log("Invalid Exif data: Invalid tag type.")},n.parseExifTag=function(t,e,i,r,o){var a=t.getUint16(i,r);o.exif[a]=n.getExifValue(t,e,i,t.getUint16(i+2,r),t.getUint32(i+4,r),r)},n.parseExifTags=function(e,n,i,r,o){var a,s,c;if(i+6>e.byteLength)t.log("Invalid Exif data: Invalid directory offset.");else{if(a=e.getUint16(i,r),!((s=i+2+12*a)+4>e.byteLength)){for(c=0;c<a;c+=1)this.parseExifTag(e,n,i+2+12*c,r,o);return e.getUint32(s,r)}t.log("Invalid Exif data: Invalid directory size.")}},n.parseExifData=function(e,i,r,o){var a,s,c=i+10;if(1165519206===e.getUint32(i+4))if(c+8>e.byteLength)t.log("Invalid Exif data: Invalid segment size.");else if(0===e.getUint16(i+8)){switch(e.getUint16(c)){case 18761:a=!0;break;case 19789:a=!1;break;default:return void t.log("Invalid Exif data: Invalid byte alignment marker.")}42===e.getUint16(c+2,a)?(s=e.getUint32(c+4,a),o.exif=new n.ExifMap,s=n.parseExifTags(e,c,c+s,a,o)):t.log("Invalid Exif data: Missing TIFF marker.")}else t.log("Invalid Exif data: Missing byte alignment offset.")},e.parsers[65505].push(n.parseExifData),n}),e("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(t,e,n){return e.register("Image",{modified:!1,init:function(){var t=this,e=new Image;e.onload=function(){t._info={type:t.type,width:this.width,height:this.height},t._metas||"image/jpeg"!==t.type?t.owner.trigger("load"):n.parseMeta(t._blob,function(e,n){t._metas=n,t.owner.trigger("load")})},e.onerror=function(){t.owner.trigger("error")},t._img=e},loadFromBlob:function(t){var e=this._img;this._blob=t,this.type=t.type,e.src=n.createObjectURL(t.getSource()),this.owner.once("load",function(){n.revokeObjectURL(e.src)})},resize:function(t,e){var n=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,n,t,e),this._blob=null,this.modified=!0,this.owner.trigger("complete","resize")},crop:function(t,e,n,i,r){var o=this._canvas||(this._canvas=document.createElement("canvas")),a=this.options,s=this._img,c=s.naturalWidth,u=s.naturalHeight,l=this.getOrientation();r=r||1,o.width=n,o.height=i,a.preserveHeaders||this._rotate2Orientaion(o,l),this._renderImageToCanvas(o,s,-t,-e,c*r,u*r),this._blob=null,this.modified=!0,this.owner.trigger("complete","crop")},getAsBlob:function(t){var e,i=this._blob,r=this.options;if(t=t||this.type,this.modified||this.type!==t){if(e=this._canvas,"image/jpeg"===t){if(i=n.canvasToDataUrl(e,t,r.quality),r.preserveHeaders&&this._metas&&this._metas.imageHead)return i=n.dataURL2ArrayBuffer(i),i=n.updateImageHead(i,this._metas.imageHead),i=n.arrayBufferToBlob(i,t)}else i=n.canvasToDataUrl(e,t);i=n.dataURL2Blob(i)}return i},getAsDataUrl:function(t){var e=this.options;return"image/jpeg"===(t=t||this.type)?n.canvasToDataUrl(this._canvas,t,e.quality):this._canvas.toDataURL(t)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(t){return t?(this._info=t,this):this._info},meta:function(t){return t?(this._metas=t,this):this._metas},destroy:function(){var t=this._canvas;this._img.onload=null,t&&(t.getContext("2d").clearRect(0,0,t.width,t.height),t.width=t.height=0,this._canvas=null),this._img.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D",this._img=this._blob=null},_resize:function(t,e,n,i){var r,o,a,s,c,u=this.options,l=t.width,d=t.height,h=this.getOrientation();~[5,6,7,8].indexOf(h)&&(n^=i,n^=i^=n),r=Math[u.crop?"max":"min"](n/l,i/d),u.allowMagnify||(r=Math.min(1,r)),o=l*r,a=d*r,u.crop?(e.width=n,e.height=i):(e.width=o,e.height=a),s=(e.width-o)/2,c=(e.height-a)/2,u.preserveHeaders||this._rotate2Orientaion(e,h),this._renderImageToCanvas(e,t,s,c,o,a)},_rotate2Orientaion:function(t,e){var n=t.width,i=t.height,r=t.getContext("2d");switch(e){case 5:case 6:case 7:case 8:t.width=i,t.height=n}switch(e){case 2:r.translate(n,0),r.scale(-1,1);break;case 3:r.translate(n,i),r.rotate(Math.PI);break;case 4:r.translate(0,i),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-i);break;case 7:r.rotate(.5*Math.PI),r.translate(n,-i),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-n,0)}},_renderImageToCanvas:function(){function e(t,e,n){var i,r,o=document.createElement("canvas"),a=o.getContext("2d"),s=0,c=n,u=n;for(o.width=1,o.height=n,a.drawImage(t,0,0),i=a.getImageData(0,0,1,n).data;u>s;)0===i[4*(u-1)+3]?c=u:s=u,u=c+s>>1;return 0==(r=u/n)?1:r}return t.os.ios?t.os.ios>=7?function(t,n,i,r,o,a){var s=n.naturalWidth,c=n.naturalHeight,u=e(n,0,c);return t.getContext("2d").drawImage(n,0,0,s*u,c*u,i,r,o,a)}:function(t,n,i,r,o,a){var s,c,u,l,d,h,p,f=n.naturalWidth,g=n.naturalHeight,m=t.getContext("2d"),v=function(t){var e,n,i=t.naturalWidth;return i*t.naturalHeight>1048576&&(e=document.createElement("canvas"),e.width=e.height=1,(n=e.getContext("2d")).drawImage(t,1-i,0),0===n.getImageData(0,0,1,1).data[3])}(n),y="image/jpeg"===this.type,b=1024,w=0,x=0;for(v&&(f/=2,g/=2),m.save(),(s=document.createElement("canvas")).width=s.height=b,c=s.getContext("2d"),u=y?e(n,0,g):1,l=Math.ceil(b*o/f),d=Math.ceil(b*a/g/u);w<g;){for(h=0,p=0;h<f;)c.clearRect(0,0,b,b),c.drawImage(n,-h,-w),m.drawImage(s,0,0,b,b,i+p,r+x,l,d),h+=b,p+=l;w+=b,x+=d}m.restore(),s=c=null}:function(e){var n=t.slice(arguments,1),i=e.getContext("2d");i.drawImage.apply(i,n)}}()})}),e("runtime/html5/transport",["base","runtime/html5/runtime"],function(t,e){var n=t.noop,i=t.$;return e.register("Transport",{init:function(){this._status=0,this._response=null},send:function(){var e,n,r,o=this.owner,a=this.options,s=this._initAjax(),c=o._blob,u=a.server;a.sendAsBinary?(u+=(/\?/.test(u)?"&":"?")+i.param(o._formData),n=c.getSource()):(e=new FormData,i.each(o._formData,function(t,n){e.append(t,n)}),e.append(a.fileVal,c.getSource(),a.filename||o._formData.name||"")),a.withCredentials&&"withCredentials"in s?(s.open(a.method,u,!0),s.withCredentials=!0):s.open(a.method,u),this._setRequestHeader(s,a.headers),n?(s.overrideMimeType&&s.overrideMimeType("application/octet-stream"),t.os.android?((r=new FileReader).onload=function(){s.send(this.result),r=r.onload=null},r.readAsArrayBuffer(n)):s.send(n)):s.send(e)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var t=this._xhr;t&&(t.upload.onprogress=n,t.onreadystatechange=n,t.abort(),this._xhr=t=null)},destroy:function(){this.abort()},_initAjax:function(){var t=this,e=new XMLHttpRequest;return!this.options.withCredentials||"withCredentials"in e||"undefined"==typeof XDomainRequest||(e=new XDomainRequest),e.upload.onprogress=function(e){var n=0;return e.lengthComputable&&(n=e.loaded/e.total),t.trigger("progress",n)},e.onreadystatechange=function(){if(4===e.readyState)return e.upload.onprogress=n,e.onreadystatechange=n,t._xhr=null,t._status=e.status,e.status>=200&&e.status<300?(t._response=e.responseText,t.trigger("load")):e.status>=500&&e.status<600?(t._response=e.responseText,t.trigger("error","server")):t.trigger("error",t._status?"http":"abort")},t._xhr=e,e},_setRequestHeader:function(t,e){i.each(e,function(e,n){t.setRequestHeader(e,n)})},_parseJson:function(t){var e;try{e=JSON.parse(t)}catch(t){e={}}return e}})}),e("preset/html5only",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/image","runtime/html5/transport"],function(t){return t}),e("webuploader",["preset/html5only"],function(t){return t}),n("webuploader")}(t,function(t,e,n){2===arguments.length&&(n=e,e=null),r(e||[],function(){o(t,n,arguments)})},r))};"object"==typeof module&&"object"==typeof module.exports?module.exports=s():"function"==typeof define&&define.amd?define(["jquery"],s):(n=t.WebUploader,t.WebUploader=s(),t.WebUploader.noConflict=function(){t.WebUploader=n})}(window),function(t,e){"use strict";var n={el:"ve-key",outerEvent:"html",addTemplate:"ve-add-tpl",serverUrl:"/api/page/savePage",btn:"<a>退出</a>",btnBottom:!0,staticUrl:"",formData:{pageUrl:window.location.pathname,port:"PC"},upload:{swf:"http://cdn.staticfile.org/webuploader/0.1.0/Uploader.swf",server:"/api/attachment/webupload?elementid=&_time=",pick:{id:"",multiple:!1},fileNumLimit:9999,extensions:"jpg|jpeg|gif|png|bmp",auto:!0,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/gif,image/jpg,image/jpeg,image/bmp,image/png,image/bmp"},resize:!1}},i=function(){this.v="1.0.0"},r=i.prototype;r.el=function(){return e("*["+n.el+"]")},r.init=function(t){return n=e.extend(!0,n,t),this.resize(),this},r.cacheList=function(){var t=[];return e.each(this.el(),function(){var i={key:e(this).attr(n.el),value:e(this).html()};t.push(i)}),t},r.config=function(){return this.api.copy(n)},r.isSrc=function(t){return t.match(/(.*)\@/)?t.match(/(.*)\@/)[1]:t.match(/(.*)\?/)?t.match(/(.*)\?/)[1]:t},r.BlockDate=function(){return(new Date).getTime()},r.isOss=function(t){return t.match(/\@(.*)/)?t.match(/\@(.*)/)[0]:t.match(/\?(.*)/)?t.match(/\?(.*)/)[0]:""};window.VE=new i}(window,$),function(t,e,n){"use strict";var i=n.__proto__;i.api={ajax:function(t,i,r){r=r||function(t){n.popup.msg("服务器繁忙请稍后再试！")};t.url=t.url+"?t="+Math.random(),t.type=t.type?t.type:"post",t.dataType=t.dataType?t.dataType:"json",t.data=t.data?t.data:{},t.error=t.error?t.error:function(t){n.popup.closeAll("loading"),r(t)},t.success=function(t){i(t)},e.ajax(t)},copy:function(t){if("object"!=typeof t)return t;var e={};for(var i in t)e[i]=n.api.copy(t[i]);return e}},i.on=function(t,e){switch(t){case"uploadSuccess":i.onUploadSuccess=e;break;case"savedataSucces":i.onSavedataSucces=e;break;case"modifySucces":i.onModifySucces=e}},i.modify=function(){if(!this.onModifySucces)return!1;var t=e("<div>"+e(n.config().outerEvent).html()+"</div>");this.onModifySucces(t.html())}}(window,$,window.VE),function(t,e,n){"use strict";n.__proto__.editType=function(){var t=n.config(),i=this;return{imgTpl:function(n){var r=new Array,o=e("<div></div>"),a=new Array;e.each(i.cacheList(),function(i,r){this.key==e(n).attr(t.el)&&(o=e("<div>"+this.value+"</div>"))}),e.each(o.find("img"),function(t,n){var r=i.isOss(e(this).attr("src"));if(e(this).attr("data-original"))o=i.isOss(e(this).attr("data-original"));else var o="";a.push({minsrc:r,maxsrc:o})}),e.each(e(n).find("img"),function(t){var n=e(this).attr("data-original")?e(this).attr("data-original"):e(this).attr("src");n=i.isSrc(n);var o=e(this).attr("data-original")?'checked="checked"':"",s=e(this).attr("data-original")?"display:block":"display:none",c=i.template({index:t,src:n,checkbox:o,display:s,defobj:a[t],alt:e(this).attr("alt")},"img");r.push(c)});var s=i.popup.open({title:"编辑图片",content:'<ul class="blockimglist"></ul>',area:["","600px"],width:1e3,height:600,type:1,btn:["保存","取消"],onBtn:function(r,o){var a=!0;if("保存"!=r)return i.popup.close(s),!1;e.each(e(".blockimglist li"),function(r,o){var s={urlsrc:e(this).find("input[name='urlsrc']"),minsrc:e(this).find("input[name='urlmin']"),maxsrc:e(this).find("input[name='urlmax']")};if(e(this).find("input[type='checkbox']").is(":checked")){if(!("@"==s.minsrc.val()[0]&&"@"==s.maxsrc.val()[0]||"?"==s.minsrc.val()[0]&&"?"==s.maxsrc.val()[0]))return i.popup.msg("请参照“@250h_250w_1e_1c或?x-oss-process=image/resize,w_250,h_250”格式书写图片尺寸！"),a=!1,!1;e(n).find("img:eq("+r+")").attr("data-original",s.urlsrc.val()+s.maxsrc.val()),e(n).find("img:eq("+r+")").attr("minsrc",s.urlsrc.val()+s.minsrc.val()),i.cacheListUp(e(n).attr("*["+t.el+"]"),{minsrc:s.minsrc.val(),maxsrc:s.maxsrc.val()},s.urlsrc.val(),r),e(n).find("img:eq("+r+")").attr("src",s.urlsrc.val()+s.maxsrc.val())}else e(n).find("img:eq("+r+")").removeAttr("data-original").removeAttr("minsrc").attr("src",s.urlsrc.val());e(n).find("img:eq("+r+")").attr("alt",e(this).find("textarea[name='alt']").val())}),a&&(i.popup.msg("操作成功！"),i.popup.close(s),i.modify())},success:function(){e(".blockimglist").append(r).find("input[type='file']"),e(".blockimglist input[name='checkbox']").change(function(){e(this).is(":checked")?e(this).parents("li").find(".divupimg").show():e(this).parents("li").find(".divupimg").hide()}),e.each(e(".blockimglist").find("a"),function(){i.webUploader("#"+e(this).attr("id"))})}})},linkTpl:function(t,n){var r=new Array;e.each(e(t).find("a"),function(t){e(this).attr("data-original")?e(this).attr("data-original"):e(this).attr("src");var o=e(this).attr("title")?e(this).attr("title"):"",a=e(document).scrollTop();n.preventDefault(),html2canvas(this,{allowTaint:!0,taintTest:!1,width:180,height:150,onrendered:function(n){n.id="mycanvas"+t,e(document).scrollTop(a),document.getElementById("boxdivlist"+t).appendChild(n)}});var s=i.template({index:t,title:o,href:e(this).attr("href")},"link");r.push(s)});var o=i.popup.open({title:"编辑链接",content:'<ul class="blockimglist"></ul>',width:1e3,height:600,type:1,btn:["保存","取消"],onBtn:function(n,r){if("保存"!=n)return i.popup.close(o),!1;e.each(e(".blockimglist li"),function(n,i){e(t).find("a:eq("+n+")").attr("href",e(this).find("input[name='href']").val()).attr("title",e(this).find("textarea[name='title']").val())}),i.popup.close(o),i.popup.msg("操作成功！",{icon:1}),i.modify()},success:function(){e(".blockimglist").append(r)}})},addTpl:function(n,r){var o=e(r).clone();e(r).before(o),this.onRemoveAdd(o,n),i.curve(e(n).find("*["+t.addTemplate+"='']"),r,!0),setTimeout(function(){i.destroy(),i.elockOff()},400)},onRemoveAdd:function(n,i){var r,o=this;e(n).attr(t.addTemplate,e(i).attr(t.el)).unbind("mousemove").mousemove(function(){r=o.removeTpl(this)}),e(n).unbind("mouseout").mouseout(function(t){if(!r)return!1;var n=e("#"+r.id).offset(),i=(e(this).offset(),parseInt(e("#"+r.id).width())),a=parseInt(e("#"+r.id).height()),s=parseInt(i+n.left),c=parseInt(a+n.top);if(t.pageX>=n.left&&t.pageX<=s&&t.pageY>=n.top&&t.pageY<=c)return!1;o.removeTpl(this,!0)})},removeTpl:function(n,r){var o=i.ergodic().calculationErgodic(e(n));o.id="ve_remove_"+e(n).prop("tagName")+e(n).index();{if(!r){e(".ve_remove").remove();var a=e(i.template(o,"remove"));return a.unbind("click").click(function(){return e(n).remove(),e(this).remove(),setTimeout(function(){i.destroy(),i.elockOff()},400),!1}),e(t.outerEvent).append(a),i.modify(),o}e("#"+o.id).remove()}}}}}(window,$,window.VE),function(t,e,n){"use strict";var i=window.VE.__proto__,r={time:1e3,content:!1,title:!1,btn:!1,success:!1,shade:!0,width:400,height:400,success:function(){},onBtn:function(t){}},o=0;i.popup={msg:function(t){return this.open(e.extend({},r,"object"==typeof t?t:{content:t}),"msg")},open:function(t,e){return new a(t,e=e||"open").index},load:function(t){return this.open(e.extend({},r,"object"==typeof t?t:{content:t}),"load")},close:function(t){e("#ve-popup-main"+t).fadeOut(200,function(){e(this).remove()})},closeAll:function(){e(".ve-popup-main").fadeOut(200,function(){e(this).remove()})}};var a=function(t,n){var i=this;i.index=++o,i.type=n,i.config=e.extend({},i.config,r,t),document.body?i.creat():setTimeout(function(){i.creat()},30),o=i.index};a.pt=a.prototype,a.pt.creat=function(){var t=this,n=e(t.template(t.type,t.config));switch(e("body").append(n),e("#ve-popup-main"+t.index).addClass("ve-show"),t.type){case"msg":setTimeout(function(){i.popup.close(t.index)},t.config.time);break;case"open":e("#ve-popup-bg"+t.index+",#ve-popup-main"+t.index+" a.ve-close").on("click",function(){i.popup.close(t.index)}),e("#ve-popup-main"+t.index+" .ve-btn a").on("click",function(){t.config.onBtn(e(this).html())})}t.config.success(this)},a.pt.template=function(t,e){var n=e.shade?'<div id="ve-popup-bg'+this.index+'" class="ve-popup-bg"></div>':"";switch(t){case"msg":n=n+'<div class="ve-msg" style="margin-left:-'+(12*e.content.length+40)/2+'px">'+e.content||"</div>";break;case"load":n+='<div class="ve-load"></div>';break;case"open":var i=this.calculation(e);n=n+'<div class="ve-open" style="height:'+i.height+"px;width:"+i.width+"px;margin:-"+i.top+"px auto auto -"+i.left+'px;"><div class="ve-title"><div class="name">'+e.title+'</div><a class="ve-close"></a></div><div class="ve-center" style="height:'+(i.height-99)+'px">'+e.content+'</div><div class="ve-btn">'+function(){var t=e.btn?"":"<a class='ve-btn-0'>确定</a>";for(var n in e.btn)t=t+'<a class="ve-btn-'+n+'">'+e.btn[n]+"</a>";return t}()+"</div></div>";break;default:n+='<div class="ve-popup"></div>'}return"<div id='ve-popup-main"+this.index+"' style='z-index:90000"+this.index+";' class='ve-popup-main' >"+n+"</div>"},a.pt.calculation=function(t,e){return{left:t.width/2,top:t.height/2,width:t.width,height:t.height}}}(window,$),function(t,e,n){"use strict";var i=n.__proto__;i.resize=function(){var t=this,i=n.config();if(0==e(i.outerEvent).find(".blockBottom").length&&e(i.outerEvent).append(this.template({addBtn:i.btn},"main")),0==this.cacheList().length)return!1;this.elockOff(),e(window).resize(function(){t.elockOff()});var r=new Array;return e.each(this.el(),function(t){e(this).is(":hidden")&&r.push(e(this).attr(i.el))}),setInterval(function(){e.each(e("*["+i.el+"]:hidden"),function(n,o){if(e(this).attr(i.el)!=r[n])return t.elockOff(),r=new Array,e.each(t.el(),function(t){e(this).is(":hidden")&&r.push(e(this).attr(i.el))}),!1})},1e3),t.modify(),this},i.destroy=function(){e(".Blickcookroom,.blockbk,.ve_remove").remove()},i.elockOff=function(){var t=this,r=n.config();e.each(this.el(),function(n,i){var o="*["+r.el+"="+e(this).attr(r.el)+"]";t.ergodicType(o)}),r.btnBottom||e(".blockBottom").hide(),e(".blockBottom").find("a").unbind("click").on("click",function(){if("保存"==e(this).text()){var o=n.popup.load();if(0==t.contrastList().length)return n.popup.msg("请修改后再提交"),!1;t.api.ajax({type:"POST",url:r.serverUrl,data:e.extend(r.formData,{data:t.contrastList()}),dataType:"json"},function(t){n.popup.close(o),i.onSavedataSucces?i.onSavedataSucces(0,t):200==t.status||0==t.code?n.popup.msg("保存成功！"):n.popup.msg(t.msg)},function(t){if(i.onSavedataSucces)return i.onSavedataSucces(t.status,t),void n.popup.close(o);n.popup.msg("链接服务器失败！")})}}),this.el().find("a").unbind("click").click(function(){return!1});var o=0,a=!1;this.el().find("*").unbind("dblclick").dblclick(function(){if("IMG"==e(this)[0].tagName)return!1;var t=setInterval(function(){o>2&&(o=0,a=!1,clearInterval(t)),o++},1e3);if(a)return!1;a=!0,e(this).attr("contenteditable","true")}).unbind("hover").hover(function(){t.curve(e(this).parents("*["+r.el+"]"),e(this).parents("*["+r.el+"]"))},function(){e(".blockbk").hide()}).blur(function(){e(this).removeAttr("contenteditable"),t.modify()})}}(window,$,window.VE),function(t,e,n){"use strict";var i=n.__proto__;i.template=function(t,e){switch(e){case"main":return'<div class="blockBottom">"当前可编辑区域<span >'+(this.cacheList().length||0)+'</span>个,是否修改？"</span><a>保存</a>'+t.addBtn+"</div>";case"block":return'<div class="block_l blockbk"></div><div class="block_r blockbk"></div><div class="block_t blockbk"></div><div class="block_b blockbk"></div><div class="block_main blockbk">新增模板</div>';case"img":return'<li imglist = "'+t.index+'"><div>\t\t\t\t\t\t<p class="img"><img src="'+t.src+'" /><a id="file_'+t.index+'" >修改</a></p>\t\t\t\t\t\t<input type="hidden" class="fl" value="'+t.src+'" name="urlsrc" />\t\t\t\t\t\t<label><span><input type="checkbox" name="checkbox" '+t.checkbox+' />是否开启预加载？</span></label>\t\t\t\t\t\t<div class="divupimg" style = "'+t.display+'"><input type="text" placeholder="默认图尺寸" name="urlmin" value="'+t.defobj.minsrc+'" /><input type="text" placeholder="高清图尺寸"  name="urlmax"  value="'+t.defobj.maxsrc+'" /></div>\t\t\t\t\t\t<textarea placeholder="图片alt" class="text" name="alt"  >'+t.alt+"</textarea>\t\t\t\t\t</div></li>";case"link":return'<li imglist = "'+t.index+'"><div>\t\t\t\t\t\t<p class="img" id="boxdivlist'+t.index+'" ><span style="font-size: 30px;"  >Link</span></p>\t\t\t\t\t\t<input type="text" name="href" placeholder="链接地址" value="'+t.href+'"  />\t\t\t\t\t\t<textarea placeholder="Title信息" class="text" name="title"  >'+t.title+"</textarea>\t\t\t\t\t</div></li>";case"remove":return'<a class="ve_remove" id="'+t.id+'" style="left:'+(t.left+t.width-22)+"px;top:"+t.top+'px" >X</a>'}return this},i.cacheListUp=function(t,n,i,r){var o=this;e.each(this.cacheList(),function(a,s){if(t==this.key){var c=e("<div>"+this.value+"</div>");e.each(c.find("img"),function(t,a){if(t==r){if(""!=n.minsrc){var s=""==o.isSrc(i)?i:o.isSrc(i);e(this).attr("src",s+n.minsrc)}e(this).attr("data-original",s+n.maxsrc)}}),this.value=c.html()}})},i.contrastList=function(){var t=n.config(),i=this,r=new Array;return e.each(this.el(),function(n){var o=e("<div>"+e(this).html().replace(/[\t\r\n]*/g,"").replace(/>[ ]*/g,">").replace(/[ ]*</g,"<")+"</div>");e.each(o.find("img"),function(t,r){if(e(this).attr("data-original"))if(e(this).attr("minsrc"))e(this).attr("src",e(this).attr("minsrc")).removeAttr("minsrc");else{var o=e("<div>"+i.cacheList()[n].value+"</div>").find("img:eq("+t+")").attr("src"),a=i.isOss(o),s=i.isSrc(e(this).attr("data-original"));e(this).attr("src",s+a).removeAttr("minsrc")}});var a={key:e(this).attr(t.el),value:o.html().replace(/[\t\r\n]*/g,"").replace(/>[ ]*/g,">").replace(/[ ]*</g,"<")};r.push(a)}),r},i.curve=function(t,i,r){function o(){r&&e(".block_main").css({height:s.height,left:s.left,top:s.top,width:s.width,display:"block","line-height":s.height+"px"}),e(".block_l").css({height:s.height,left:s.left,top:s.top}),e(".block_t").css({width:s.width,left:s.left,top:s.top}),e(".block_r").css({height:s.height,left:s.left+s.width,top:s.top}),e(".block_b").css({width:s.width,left:s.left,top:s.top+s.height})}var a=n.config();e(".blockbk").hide();var s=this.ergodic().calculationErgodic(t);0==e(".blockbk").length?(e(a.outerEvent).append(this.template({},"block")),o()):(o(),e(".blockbk").show(),r||e(".block_main").hide())},i.BlockMoveHtml=function(t,i,r){var o=n.config(),a="";a+='<a href="javascript:;" class="img" data-block="'+t+'" >编辑图片</a><a href="javascript:;" data-block="'+t+'" class="link" >编辑链接</a><a href="javascript:;" data-block="'+t+'" class="addtpl" >新增</a>';var s="";0==e("#Blick"+t).length?(s='<div class="Blickcookroom" id="Blick'+t+'" style="'+i+'position: absolute; font-size:12px; z-index:900;  background:rgba(0,0,0,0.02); text-align: center;">\t\t\t\t'+a+"\t\t\t\t</div>",e(o.outerEvent).append(s)):e("#Blick"+t).attr("style",i+""),"IMG"==r&&e("#Blick"+t).find(".img").css("display","inline-block"),"A"==r&&e("#Blick"+t).find(".link").css("display","inline-block"),"tpl"==r&&e("#Blick"+t).find(".addtpl").css("display","inline-block")},i.ergodic=function(){var t=n.config(),i=this,r=this.editType();return{imgErgodic:function(n,o){var a=this.calculationErgodic(o);i.BlockMoveHtml(e(o).attr(t.el),"width:"+a.width+"px;height:0px;top:"+a.top+"px;left:"+a.left+"px;","IMG"),e(o).is(":hidden")?e("#Blick"+e(o).attr(t.el)).hide():e("#Blick"+e(o).attr(t.el)).show(),e("#Blick"+e(o).attr(t.el)).find(".img").unbind("click").click(function(){r.imgTpl(o)})},linkErgodic:function(n,o){var a=this.calculationErgodic(o);i.BlockMoveHtml(e(o).attr(t.el),"width:"+a.width+"px;height:0px;top:"+a.top+"px;left:"+a.left+"px;","A"),e(o).is(":hidden")?e("#Blick"+e(o).attr(t.el)).hide():e("#Blick"+e(o).attr(t.el)).show(),e("#Blick"+e(o).attr(t.el)).find(".link").unbind("click").click(function(t){r.linkTpl(o,t)})},addTplErgodic:function(n,o){var a=this.calculationErgodic(n);i.BlockMoveHtml(e(o).attr(t.el),"width:"+a.width+"px;height:0px;top:"+a.top+"px;left:"+a.left+"px;","tpl"),e(o).is(":hidden")?e("#Blick"+e(o).attr(t.el)).hide():e("#Blick"+e(o).attr(t.el)).show(),e("#Blick"+e(o).attr(t.el)).find(".addtpl").unbind("click").click(function(){r.addTpl(o,n)}).unbind("mousemove").mousemove(function(n){i.curve(e(o).find("*["+t.addTemplate+"='']"),e(o),!0)}).unbind("mouseout").mouseout(function(){e(".blockbk").hide()})},textErgodic:function(){},calculationErgodic:function(n){var i=t.outerEvent?function(t){return{left:t.offset().left,top:t.offset().top}}(e(t.outerEvent)):{left:0,top:0};return{width:e(n).width()+parseInt(e(n).css("padding-right"))+parseInt(e(n).css("padding-left"))+2*(parseInt(e("div").css("borderTopWidth"))||0),height:e(n).height()+parseInt(e(n).css("padding-top"))+parseInt(e(n).css("padding-bottom"))+2*(parseInt(e("div").css("borderTopWidth"))||0),top:e(n).offset().top-2*(parseInt(e(n).css("borderTopWidth"))||0)-i.top,left:e(n).offset().left-2*(parseInt(e(n).css("borderTopWidth"))||0)-i.left}}}},i.ergodicType=function(t){var i=n.config(),r=this.editType(),o=this.ergodic();return e.each(e(t).find("*"),function(n,a){if(void 0!==e(this).attr(i.addTemplate)){t="*["+i.el+"='"+e(t).attr(i.el)+"']",o.addTplErgodic(this,t);var s=e(t).attr(i.el);e(this).attr(i.addTemplate)==s&&r.onRemoveAdd(this,t)}switch(this.tagName){case"IMG":o.imgErgodic(this,t);break;case"A":o.linkErgodic(this,t);break;default:o.textErgodic()}}),this}}(window,$,window.VE),function(t,e,n){"use strict";var i=n.__proto__;i.webUploader=function(t){var r,o=n.config();o.upload.pick.id=t;var a=WebUploader.create(o.upload);a.on("error",function(t){return"F_EXCEED_SIZE"==t||"Q_EXCEED_SIZE_LIMIT"==t?(n.popup.msg("上传的图片太大"),!1):"Q_TYPE_DENIED"==t?(n.popup.msg("请上传JPG、GIF、PNG、JPEG、BMP格式"),!1):"Q_EXCEED_NUM_LIMIT"==t?(n.popup.msg("超过图片最大上传数量"),!1):(n.popup.msg("服务器繁忙请稍候再试"),!1)}),a.on("fileQueued",function(t,e){r=n.popup.load()}),a.on("uploadSuccess",function(o,a){if(n.popup.close(r),i.onUploadSuccess)return i.onUploadSuccess(e(t),o,a),!1;200==a.code?(e(t).parent().find("img").attr("src",a.fileurl),e(t).parents("li").find("input[name='urlsrc']").val(a.fileurl)):0==a.code?(e(t).parent().find("img").attr("src",a.result),e(t).parents("li").find("input[name='urlsrc']").val(a.result)):alert("服务器繁忙请稍后再试...")}),a.on("uploadError",function(t){n.popup.close(r),n.popup.msg("服务器链接失败！")})}}(window,$,window.VE);